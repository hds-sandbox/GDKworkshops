<!DOCTYPE html>
<html lang="en"><head>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.31">

  <meta name="author" content="Samuele Soraggi">
  <meta name="author" content="Manuel Peral-Vázquez">
  <meta name="author" content="Dan Søndergaard">
  <meta name="dcterms.date" content="2025-05-28">
  <title>GenomeDK workshops – Advanced GenomeDK</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/theme/quarto-f563837468303362081e247dddd440d0.css">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-QZP3HK6BQT"></script>

  <script type="text/javascript">

  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-QZP3HK6BQT', { 'anonymize_ip': true});
  </script>
  <link href="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="../../../site_libs/quarto-diagram/mermaid.min.js"></script>
  <script src="../../../site_libs/quarto-diagram/mermaid-init.js"></script>
  <link href="../../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Advanced GenomeDK</h1>
  <p class="subtitle">More-than-basic things to do and tips for GDK, tinyurl.com/advGDK</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Samuele Soraggi 
</div>
        <p class="quarto-title-affiliation">
            Health Data Science sandbox, BiRC, AU
          </p>
    </div>
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Manuel Peral-Vázquez 
</div>
        <p class="quarto-title-affiliation">
            Molecular Biology and Genetics, AU
          </p>
    </div>
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Dan Søndergaard 
</div>
        <p class="quarto-title-affiliation">
            GenomeDK, Health, AU
          </p>
    </div>
</div>

  <p class="date">2025-05-28</p>
</section>
<section>
<section id="some-background" class="title-slide slide level1 center">
<h1>Some background</h1>
<ul>
<li><p>These slides are both a presentation and a small reference manual</p></li>
<li><p>90% of slides are you doing stuff - <strong>open your terminals and slides</strong></p></li>
<li><p>Official reference documentation: <a href="https://genome.au.dk">genome.au.dk</a></p></li>
<li><p>Some advanced things require a bit of practice/frustration, but I hope to reduce it</p></li>
<li><p>Most important message before starting any workshop: <a href="https://idratherbewriting.com/2012/08/30/the-blame-game-of-rtfm/">RTFM - Read The Field Manual!</a>. Though</p>
<ul>
<li>Some manuals are really useless, but the ones for UNIX tools are pretty good</li>
<li>Unusual options might be buried somewhere or badly explained</li>
</ul></li>
</ul>
</section>
<section id="when-you-need-to-ask-for-help" class="slide level2">
<h2>When you need to ask for help</h2>
<ul>
<li><p><strong>Practical help:</strong></p>
<p>Samuele (BiRC, MBG) - samuele@birc.au.dk</p></li>
<li><p><strong>Drop in hours:</strong></p>
<ul>
<li>Bioinformatics Cafe: <a href="abc.au.dk">https://abc.au.dk</a>, abcafe@au.dk</li>
<li>Samuele (BiRC, MBG) - samuele@birc.au.dk - we just set up a meeting/zoom</li>
</ul></li>
<li><p><strong>General mail for assistance</strong></p>
<p>support@genome.au.dk</p></li>
</ul>
</section>
<section id="program" class="slide level2 scrollable">
<h2>Program</h2>
<ul>
<li><strong>10:00-10:30</strong>:
<ul>
<li>Workshop Introduction</li>
<li>Some everyday things for easier life
<ul>
<li>and your mental sanity</li>
</ul></li>
</ul></li>
<li><strong>10:30-11:00</strong>:
<ul>
<li><code>rsync</code> copy and backups</li>
<li>[Optional] Managing multiple terminals on <code>tmux</code></li>
<li>cake</li>
</ul></li>
<li><strong>11:10-12:00</strong>:
<ul>
<li>Web applications, ports and tunnels</li>
<li>Containers (Docker, singularity)</li>
</ul></li>
<li><strong>12:45-14:00</strong>:
<ul>
<li>Your first pipeline with <code>gwf</code>, <code>conda</code> and <code>containers</code>
<ul>
<li>more cake</li>
<li>resource management</li>
<li>adding targets to a pipeline</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="get-the-slides" class="slide level2">
<h2>Get the slides</h2>
<p>Webpage: <a href="https://hds-sandbox.github.io/GDKworkshops/">https://hds-sandbox.github.io/GDKworkshops/</a></p>

<img data-src="./img/webpageGDK.png" class="r-stretch quarto-figure-center"><p class="caption">Slides will always be up to date in this webpage</p></section>
<section id="navigate-the-slides" class="slide level2">
<h2>Navigate the slides</h2>

<img data-src="./img/slideGuide.png" class="quarto-figure quarto-figure-center r-stretch"></section></section>
<section>
<section id="some-useful-things-for-an-easier-life" class="title-slide slide level1 center">
<h1>Some useful things for an easier life</h1>
<ul>
<li>Configuration file(s)</li>
<li>System variables</li>
<li>Safety settings</li>
<li>Shortcuts</li>
</ul>
</section>
<section id="configuration-files" class="slide level2">
<h2>Configuration files</h2>
<p>Your <code>~/.bashrc</code> file contains settings for your user. Those are bash commands which run at every login.</p>
<p>&nbsp;</p>
<p>Common practice for many softwares is to have a configuration file in your home, often starting with <code>.</code>, which makes it a hidden file.</p>
<p>&nbsp;</p>
<p>Examples:</p>
<ul>
<li><code>.tmux.config</code> for <code>tmux</code></li>
<li><code>.emacs</code> for emacs</li>
<li><code>.gitconfig</code> for github</li>
<li><code>.condarc</code> for conda</li>
</ul>
<p>Plus other things like your command history on the terminal.</p>
</section>
<section id="exercise-i-singularity-settings" class="slide level2">
<h2>Exercise I: singularity settings</h2>
<p>Let’s make a useful setting to run at each login. We will need a temporary folder for <code>singularity</code> containers which are downloaded. Default is your home, which will be filled up in no time (folder <code>~/.singularity</code>) with cache material.</p>
<p>&nbsp;</p>
<p>Edit the file <code>~/.bashrc</code> (use <code>nano ~/.bashrc</code> or any editor you want). Add those lines:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="at">-m</span> 700 /tmp/<span class="va">$USER</span></span>
<span id="cb1-2"><a aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">SINGULARITY_TMPDIR</span><span class="op">=</span>/tmp/<span class="va">$USER</span></span>
<span id="cb1-3"><a aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">SINGULARITY_CACHEDIR</span><span class="op">=</span>/tmp/<span class="va">$USER</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>&nbsp;</p>
<p>The <code>-m 700</code> option for <code>mkdir</code> command ensures also <strong>you are the only one which can see the temporary files</strong>. Useful is you use a container with password or sensitive info, so no one can access it (<code>/tmp/</code> is a public folder)!</p>
</section>
<section id="exercise-ii---aliases" class="slide level2 scrollable">
<h2>Exercise II - aliases</h2>
<p>Now, there are many repetitive things we do every day. For example:</p>
<ul>
<li>remove files and double check we can</li>
<li><code>cd ../</code> and <code>cd ../../</code> and … and <code>cd ../../../../../../../</code></li>
</ul>
<p>and every time it is just annoying to waste precious time. Why not creating some aliases for all those deplorable commands? Choose the aliases you prefere from the list below and add them in your <code>.bashrc</code> file:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a aria-hidden="true" tabindex="-1"></a><span class="co">## Safe file handling</span></span>
<span id="cb2-2"><a aria-hidden="true" tabindex="-1"></a><span class="bu">alias</span> rmi=<span class="st">'rm -i'</span></span>
<span id="cb2-3"><a aria-hidden="true" tabindex="-1"></a><span class="bu">alias</span> cpi=<span class="st">'cp -i'</span></span>
<span id="cb2-4"><a aria-hidden="true" tabindex="-1"></a><span class="bu">alias</span> mvi=<span class="st">'mv -i'</span></span>
<span id="cb2-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a aria-hidden="true" tabindex="-1"></a><span class="co">## Upwards navigation in the File system</span></span>
<span id="cb2-7"><a aria-hidden="true" tabindex="-1"></a><span class="bu">alias</span> ..=<span class="st">'cd ..'</span></span>
<span id="cb2-8"><a aria-hidden="true" tabindex="-1"></a><span class="bu">alias</span> ...=<span class="st">'cd ../../../'</span></span>
<span id="cb2-9"><a aria-hidden="true" tabindex="-1"></a><span class="bu">alias</span> ....=<span class="st">'cd ../../../../'</span></span>
<span id="cb2-10"><a aria-hidden="true" tabindex="-1"></a><span class="bu">alias</span> .....=<span class="st">'cd ../../../../'</span></span>
<span id="cb2-11"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a aria-hidden="true" tabindex="-1"></a><span class="co">## List views</span></span>
<span id="cb2-13"><a aria-hidden="true" tabindex="-1"></a><span class="bu">alias</span> ll=<span class="st">'ls -laht'</span> <span class="co">#detailed</span></span>
<span id="cb2-14"><a aria-hidden="true" tabindex="-1"></a><span class="bu">alias</span> l=<span class="st">'ls -aC'</span> <span class="co">#compressed</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="exercise-iii---functions" class="slide level2 scrollable">
<h2>Exercise III - functions</h2>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>These are just inspirations, you can create any alias and function to avoid repetitive/long commands. Find all repetitive stupid stuff you use and wrap it up into the <code>.bashrc</code> file!</p>
</div>
</div>
</div>
<p>You can also create functions including multiple commands: for example making a directory and then <code>cd</code> into it.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a aria-hidden="true" tabindex="-1"></a><span class="co">## make and cd</span></span>
<span id="cb3-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mkcd()</span> <span class="kw">{</span></span>
<span id="cb3-3"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mkdir</span> <span class="at">-p</span> <span class="va">$1</span><span class="kw">;</span> <span class="bu">cd</span> <span class="va">$1</span></span>
<span id="cb3-4"><a aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> created <span class="va">$1</span></span>
<span id="cb3-5"><a aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Why not making one for <code>git clone</code> downloading only the latest commit history and choosing specific folders for the repository?</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Git clone with depth 1 and choice of folders</span></span>
<span id="cb4-2"><a aria-hidden="true" tabindex="-1"></a><span class="co">#   arg 1: username/repository</span></span>
<span id="cb4-3"><a aria-hidden="true" tabindex="-1"></a><span class="co">#   arg 2: folders and files in quotes '', backspace separator</span></span>
<span id="cb4-4"><a aria-hidden="true" tabindex="-1"></a><span class="co">#   arg 3: download folder name (optional, default:repo)</span></span>
<span id="cb4-5"><a aria-hidden="true" tabindex="-1"></a><span class="co">#   arg 4: branch (optional, default:main)</span></span>
<span id="cb4-6"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Examples:</span></span>
<span id="cb4-7"><a aria-hidden="true" tabindex="-1"></a><span class="co">#   ghdir github/gitignore 'community Global' test01 main</span></span>
<span id="cb4-8"><a aria-hidden="true" tabindex="-1"></a><span class="co">#   ghdir github/gitignore 'community Global' </span></span>
<span id="cb4-9"><a aria-hidden="true" tabindex="-1"></a><span class="fu">ghdir()</span> <span class="kw">{</span></span>
<span id="cb4-10"><a aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> Downloading from <span class="va">$1</span> in folder <span class="va">$3</span></span>
<span id="cb4-11"><a aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> Selecting <span class="va">$2</span></span>
<span id="cb4-12"><a aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">[</span> <span class="ot">-z</span> <span class="st">"</span><span class="va">$4</span><span class="st">"</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb4-13"><a aria-hidden="true" tabindex="-1"></a>          <span class="va">BRANCH</span><span class="op">=</span><span class="st">"-b main"</span></span>
<span id="cb4-14"><a aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb4-15"><a aria-hidden="true" tabindex="-1"></a>          <span class="va">BRANCH</span><span class="op">=</span><span class="st">"-b </span><span class="va">$4</span><span class="st">"</span></span>
<span id="cb4-16"><a aria-hidden="true" tabindex="-1"></a>        <span class="cf">fi</span></span>
<span id="cb4-17"><a aria-hidden="true" tabindex="-1"></a>        <span class="fu">git</span> clone <span class="at">--no-checkout</span> <span class="va">$BRANCH</span> <span class="at">--filter</span><span class="op">=</span>blob:none <span class="at">--depth</span> 1 https://github.com/<span class="va">$1</span>.git <span class="va">$3</span></span>
<span id="cb4-18"><a aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">[</span> <span class="ot">-z</span> <span class="st">"</span><span class="va">$3</span><span class="st">"</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb4-19"><a aria-hidden="true" tabindex="-1"></a>          <span class="va">folder</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="st">"</span><span class="va">$1</span><span class="st">"</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-d</span><span class="st">'/'</span> <span class="at">-f2</span><span class="va">)</span></span>
<span id="cb4-20"><a aria-hidden="true" tabindex="-1"></a>          <span class="bu">cd</span> <span class="st">"</span><span class="va">$folder</span><span class="st">"</span></span>
<span id="cb4-21"><a aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb4-22"><a aria-hidden="true" tabindex="-1"></a>          <span class="bu">cd</span> <span class="st">"</span><span class="va">$3</span><span class="st">"</span></span>
<span id="cb4-23"><a aria-hidden="true" tabindex="-1"></a>        <span class="cf">fi</span></span>
<span id="cb4-24"><a aria-hidden="true" tabindex="-1"></a>        <span class="fu">git</span> sparse-checkout init <span class="at">--cone</span></span>
<span id="cb4-25"><a aria-hidden="true" tabindex="-1"></a>        <span class="fu">git</span> sparse-checkout set <span class="va">$2</span></span>
<span id="cb4-26"><a aria-hidden="true" tabindex="-1"></a>        <span class="fu">git</span> checkout</span>
<span id="cb4-27"><a aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section></section>
<section>
<section id="syncronizations-multiple-terminals" class="title-slide slide level1 center">
<h1>Syncronizations, multiple terminals</h1>
<ul>
<li>How to copy using <code>rsync</code></li>
<li>Use <code>rsync</code> to create backups and versioning</li>
<li>Create and navigate multiple sessions with <code>tmux</code></li>
<li>Launch parallel background downloads with <code>tmux</code></li>
</ul>
</section>
<section id="transfer-and-sync-with-rsync" class="slide level2">
<h2>transfer and sync with <code>rsync</code></h2>
<p><code>rsync</code> is a very versatile tool for</p>
<ul>
<li>transfering <strong>from remote to local</strong> host (and viceversa)</li>
<li>copying from <strong>local to local</strong> host (e.g.&nbsp;data backups/sync)</li>
<li>transfering only files which has changed from last copy (<strong>incremental copy</strong>)</li>
</ul>
<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Warning</strong></p>
</div>
<div class="callout-content">
<p><code>rsync</code> cannot make a transfer between two remote hosts, e.g.&nbsp;running from your PC to transfer data between GenomeDK and Computerome.</p>
<p><code>rsync</code> cannot download from web URLs</p>
</div>
</div>
</div>
<p>Lots of options you can find in the manual (would require a workshop only for that)</p>
<div style="text-align: center; margin-top: 20px;">
<p><a href="https://linux.die.net/man/1/rsync" target="_blank" style="display: inline-block; padding: 10px 20px; background-color: #007BFF; color: white; text-decoration: none; border-radius: 5px; border: 2px solid #0056b3; font-weight: bold;"> rsync manual </a></p>
</div>
</section>
<section id="exercise" class="slide level2">
<h2>Exercise</h2>
<p>Log into GenomeDK. Create anywhere you prefere a folder called <code>advancedGDK</code> containing <code>rsync/data</code></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> advancedGDK/rsync/data</span>
<span id="cb5-2"><a aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> advancedGDK/rsync</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Create 100 files with extensions <code>fastq</code> and <code>log</code> in the data folder</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> data/file{1..100}.fastq data/file{1..100}.log</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

<h3 id="local-to-local-copy">Local-to-local copy</h3>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>The syntax of <code>rsync</code> is pretty simple:</p>
<pre><code>rsync OPTIONS ORIGIN(s) DESTINATION</code></pre>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>An archive (incremental) copy can be done with the options <code>a</code>. You can add a progress bar with <code>P</code>. You can exclude files: here we want only the ones with <code>fastq</code> extension. Run the command</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-aP</span> <span class="at">--exclude</span><span class="op">=</span><span class="st">"*.log"</span> data backup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This will copy all the <code>fastq</code> files in <code>backup/data</code>. You can check with <code>ls</code>.</p>
<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Warning</strong></p>
</div>
<div class="callout-content">
<p>Using <code>data</code> will copy the entire folder, while <code>data/</code> will copy only its content! This is common to many other UNIX tools.</p>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>Change the first ten <code>fastq</code> files with some text:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">10</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span> <span class="bu">echo</span> hello <span class="op">&gt;&gt;</span> data/file<span class="va">$i</span>.fastq<span class="kw">;</span> <span class="cf">done</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, we do not only want to do an incremental copy of those file with <code>rsync</code>, but also keep the previous version of those files. We create a folder to backup those, naming it with date and time (you will find it in your <code>backup</code> directory):</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-aP</span> <span class="at">--exclude</span><span class="op">=</span><span class="st">"*.log"</span> <span class="dt">\</span></span>
<span id="cb10-2"><a aria-hidden="true" tabindex="-1"></a>      <span class="at">--backup</span> <span class="dt">\</span></span>
<span id="cb10-3"><a aria-hidden="true" tabindex="-1"></a>      <span class="at">--backup-dir</span><span class="op">=</span>versioning_<span class="va">$(</span><span class="fu">date</span> +%F_%T<span class="va">)</span>/ <span class="dt">\</span></span>
<span id="cb10-4"><a aria-hidden="true" tabindex="-1"></a>      data <span class="dt">\</span></span>
<span id="cb10-5"><a aria-hidden="true" tabindex="-1"></a>      backup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Tip</strong></p>
</div>
<div class="callout-content">
<p>If you create a folder called <code>backup</code> in your project folder, you can use versioning to store your analysis and results with incremental changes.</p>
</div>
</div>
</div>
<p><strong>Exercise finished</strong></p>
</section>
<section class="slide level2">

<h3 id="transfer-between-local-and-remote">Transfer between local and remote</h3>
<p>You can in the same way transfer and backup data between your local host (your PC, or GenomeDK) and another remote host (another cluster). You need Linux or Mac on the local host. For example, to get on your computer the same <code>fastq</code> files:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-aP</span> <span class="at">--exclude</span><span class="op">=</span><span class="st">"*.log"</span> USERNAME@login.genome.au.dk:PATH_TO/advancedGDK/data PATH_TO/backup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The opposite can be done uploading data from your computer. For example:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-aP</span> <span class="at">--exclude</span><span class="op">=</span><span class="st">"*.log"</span> PATH_TO/data USERNAME@login.genome.au.dk:PATH_TO/backup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>&nbsp;</p>
<div title="Avoid a typical error">
<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Avoid a typical error</strong></p>
</div>
<div class="callout-content">
<p>To transfer from GenomeDK to your computer, and viceversa, you need to use the commands above <strong>from your local computer</strong>, and NOT when you are logged into GenomeDK!</p>
</div>
</div>
</div>
</div>
</section>
<section id="optional-manage-multiple-terminals-with-tmux" class="slide level2">
<h2>[Optional] Manage multiple terminals with <code>tmux</code></h2>
<p><code>tmux</code> is a server application managing multiple terminal sessions. It can</p>
<ul>
<li>start a server with multiple <strong>sessions</strong></li>
<li>each session containing one or more <strong>windows with multiple terminals (panes)</strong></li>
<li>each terminal run simultaneously and be accessed <strong>(attached)</strong> or exited from <strong>(detached)</strong></li>
<li>the tmux server keeps runninng <strong>without a logged user</strong></li>
</ul>

<img data-src="img/tmux-server.png" class="quarto-figure quarto-figure-center r-stretch" width="400"></section>
<section id="exercise-1" class="slide level2">
<h2>Exercise</h2>
<p><code>tmux</code> is a keyboard-only software. But you can set it up also to change windows and panes with the mouse. Simply run this command (<strong>only once</strong>) to enable mouse usage:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"set -g mouse"</span> <span class="op">&gt;&gt;</span> ~/.tmux.conf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Warning</strong></p>
</div>
<div class="callout-content">
<p>Using the mouse can create problems in some terminal programs, where copy-paste starts acting weird, e.g.&nbsp;on Mac computers and on Windows’ Moba XTerm software. In case you have a bad experience, remove the mouse setup from the file <code>~/.tmux.conf</code></p>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>You can start a <code>tmux</code> session anywhere. It is easier to navigate sessions giving them a name. For example start a session called <code>example1</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">tmux</span> new <span class="at">-s</span> example1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

<p>The command will set you into the session automatically. The window looks something like below:</p>

<img data-src="img/tmuxSession.png" class="quarto-figure quarto-figure-center r-stretch" width="600"></section>
<section class="slide level2">

<p>Now, you are in session <code>example1</code> and have one window, which you are using now. You can split the window in multiple terminals. Try both those combinations of buttons:</p>
<p>&nbsp;</p>
<pre><code>Ctrl + b    %

Ctrl + b    ""</code></pre>
<p>&nbsp;</p>
<p>Or keep right-clicked with the mouse to choose the split.</p>
<p>Do split the window horizontally and vertically, running 3 terminals. You can select any of them with the mouse (left-click).</p>
<p>Try to select a window and resize it: while keeping <code>Ctrl + b</code> pressed, use the arrows to change the size</p>
</section>
<section class="slide level2">

<p>Now, you have your three panes running in a window.</p>
<p>Create a new window with <code>Ctrl + b   c</code>. Or keep right-clicked on the window bar and create a new window.</p>
<p>&nbsp;</p>
<p>You should see another window added in the bottom window bar. Again, switch between windows with your mouse (left-click!)</p>
<p>In the new window, let’s look at which tmux sessions and windows are open. Run</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">tmux</span> ls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>&nbsp;</p>
<p>The output will tell you that session <code>example1</code> is in use (attached) and has 2 windows. Something like this:</p>
<pre><code>example1: 2 windows (created Wed Apr  2 16:12:54 2025) (attached)</code></pre>
</section>
<section class="slide level2">

<h3 id="launching-separate-downloads-at-the-same-time">Launching separate downloads at the same time</h3>
<p>Start a new session without attaching to it (<code>d</code> option), and call it <code>downloads</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">tmux</span> new-session <span class="at">-d</span> <span class="at">-s</span> downloads</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>verify the session is there with <code>tmux ls</code>.</p>
<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Warning</strong></p>
</div>
<div class="callout-content">
<p>If you want a new session attaching to it, you need to detach from the current session with <code>Ctrl + b + d</code>.</p>
</div>
</div>
</div>
<p>Create a text file with few example files for this workshop to be downloaded.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-s</span> https://api.github.com/repos/hds-sandbox/GDKworkshops/contents/Examples/rsync <span class="kw">|</span> <span class="ex">jq</span> <span class="at">-r</span> <span class="st">'.[] | .download_url'</span> <span class="op">&gt;</span> downloads.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

<p>Now, the script below launches all the URLs from the list in the download session in a new window. The new window closes after the download. If there are less than K downloads active, a new one starts, until the end! You can use this and close your terminal. The downloads will keep going and the window names will be shown to keep an eye on the current downloads. Try it out and use it whenever you have massive number of file downloads.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> downloaded</span>
<span id="cb20-2"><a aria-hidden="true" tabindex="-1"></a><span class="va">K</span><span class="op">=</span>2  <span class="co"># Maximum number of concurrent downloads</span></span>
<span id="cb20-3"><a aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">read</span> <span class="at">-r</span> <span class="va">url</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb20-4"><a aria-hidden="true" tabindex="-1"></a>    <span class="co"># Wait until the number of active tmux windows in the "downloads" session is less than K</span></span>
<span id="cb20-5"><a aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="bu">[</span> <span class="st">"</span><span class="va">$(</span><span class="ex">tmux</span> list-windows <span class="at">-t</span> downloads <span class="kw">|</span> <span class="fu">wc</span> <span class="at">-l</span><span class="va">)</span><span class="st">"</span> <span class="ot">-ge</span> <span class="st">"</span><span class="va">$((K</span><span class="op">+</span><span class="dv">1</span><span class="va">))</span><span class="st">"</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">do</span>     </span>
<span id="cb20-6"><a aria-hidden="true" tabindex="-1"></a>        <span class="fu">sleep</span> 1</span>
<span id="cb20-7"><a aria-hidden="true" tabindex="-1"></a>    <span class="cf">done</span></span>
<span id="cb20-8"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the filename from the URL</span></span>
<span id="cb20-10"><a aria-hidden="true" tabindex="-1"></a>    <span class="va">filename</span><span class="op">=</span><span class="va">$(</span><span class="fu">basename</span> <span class="st">"</span><span class="va">$url</span><span class="st">"</span><span class="va">)</span></span>
<span id="cb20-11"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a aria-hidden="true" tabindex="-1"></a>    <span class="co"># Start a new tmux window for the download</span></span>
<span id="cb20-13"><a aria-hidden="true" tabindex="-1"></a>    <span class="ex">tmux</span> new-window <span class="at">-t</span> downloads <span class="at">-n</span> <span class="st">"</span><span class="va">$filename</span><span class="st">"</span> <span class="st">"wget -c </span><span class="va">$url</span><span class="st"> -O downloaded/</span><span class="va">$filename</span><span class="st"> &amp;&amp; tmux kill-window"</span></span>
<span id="cb20-14"><a aria-hidden="true" tabindex="-1"></a>    <span class="ex">tmux</span> list-windows <span class="at">-t</span> downloads <span class="at">-F</span> <span class="st">"#{window_name}"</span>   </span>
<span id="cb20-15"><a aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&lt;</span> downloads.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Exercise finished</strong></p>
</section></section>
<section>
<section id="web-applications-ports-tunneling" class="title-slide slide level1 center">
<h1>Web applications, ports, tunneling</h1>

</section>
<section id="web-applications" class="slide level2">
<h2>Web applications</h2>
<p>&nbsp; Why do we use web applications for graphical interfaces?</p>
<p>&nbsp; - all the graphics heavy-lifting is done by the browser - before, the X11 forwarding was the way to do graphics from remote - problem: X11 sends the whole graphics over the network, which is slow</p>
<p>&nbsp; <a href="https://abc.au.dk/documentation/2024-11-28-ABC9.html">We have written a bit about that on one of our ABC tutorials</a></p>
</section>
<section class="slide level2">

<p>A web application on GenomeDK:</p>
<ul>
<li>starts a <strong>server process</strong> on the cluster</li>
<li>This server listens for incoming requests on a specific <strong>port</strong></li>
<li>The server sends and receives data over the network via the port.</li>
</ul>
<p>&nbsp;</p>
<p>The local user:</p>
<ul>
<li>creates a <strong>tunnel</strong>, which is an <code>ssh</code> connection mapping to the remote port used by the server process</li>
</ul>
</section>
<section class="slide level2">


<img data-src="img/sshPortForwarding.png" width="800" class="r-stretch quarto-figure-center"><p class="caption">How the port forwarding looks like from the local user (your pc) to the remote node of the cluster. The purple command has to be launched on the local computer, once the server is running on the remote host. Source: KU Leuven.</p></section>
<section class="slide level2">

<h3 id="which-port-to-use">Which port to use</h3>
<ul>
<li><p>Each server process on a machine needs a <strong>unique port</strong> (p2 on previous figure) to avoid conflicts.</p></li>
<li><p>Ports are in common between users on GenomeDK. So you can only use the port corresponding to your user number, which you can see with</p>
<p><code>echo $UID</code></p></li>
<li><p>You will see all this in the next exercise</p></li>
</ul>
<div title="better safe than sorry">
<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>better safe than sorry</strong></p>
</div>
<div class="callout-content">
<p>Launch a web application which has tokens (a random code in the URL for the browser) or a password. In theory, anyone on your same node of the cluster can get into your server process and see your program and data!</p>
</div>
</div>
</div>
</div>
</section>
<section id="exercise-jupyterlab-web-server" class="slide level2 scrollable">
<h2>Exercise: jupyterlab web server</h2>
<p>If you DO NOT have the <code>conda</code> package manager, you can quickly install it from the box below, otherwise move to the next slide!</p>
<div title="Install conda">
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Install conda</strong></p>
</div>
<div class="callout-content">
<p>Run the installation script to install the software. There are some informative messages during the installation. You might need to say <code>yes</code> a few times</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-x86_64.sh <span class="at">-O</span> miniforge.sh</span>
<span id="cb21-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x miniforge.sh</span>
<span id="cb21-3"><a aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> miniforge.sh <span class="at">-b</span></span>
<span id="cb21-4"><a aria-hidden="true" tabindex="-1"></a><span class="ex">~/miniforge3/bin/conda</span> init bash</span>
<span id="cb21-5"><a aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> ~/.bashrc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When you are done, you need a little bit of configuration. You can run the following command to configure <code>conda</code> (run them only once, they are not needed again):</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> config <span class="at">--append</span> channels conda-forge</span>
<span id="cb22-2"><a aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> config <span class="at">--append</span> channels bioconda</span>
<span id="cb22-3"><a aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> config <span class="at">--set</span> channel_priority strict</span>
<span id="cb22-4"><a aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> config <span class="at">--set</span> auto_activate_base false</span>
<span id="cb22-5"><a aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> ~/.bashrc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Finally, install a package to accellerate <code>conda</code>. This is optional but recommended:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> install <span class="at">-n</span> base <span class="at">--yes</span> conda-libmamba-solver</span>
<span id="cb23-2"><a aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> config <span class="at">--set</span> solver libmamba</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now you are ready to move on!</p>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>Create a new <code>conda</code> environment:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> create <span class="at">-y</span> <span class="at">-n</span> GDKjupyter jupyterlab numpy pandas</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>&nbsp;</p>
<p>Start a job with just a few resources. This will always keep running until the end since it is inside a tmux session!</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">srun</span> <span class="at">--mem</span><span class="op">=</span>4g <span class="at">--cores</span><span class="op">=</span>1 <span class="at">--time</span><span class="op">=</span>4:00:0 <span class="at">--pty</span> /bin/bash</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>&nbsp;</p>
<p>Now activate your environment and run jupyterlab. The node name (remote host) and your user ID (for the port number) <strong>are given as variables</strong> to the web server simply using <code>$(hostname)</code> and $UID:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> activate GDKjupyter</span>
<span id="cb26-2"><a aria-hidden="true" tabindex="-1"></a><span class="ex">jupyter-lab</span> <span class="at">--port</span><span class="op">=</span><span class="va">$UID</span> <span class="at">--ip</span><span class="op">=</span><span class="va">$(</span><span class="fu">hostname</span><span class="va">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

<p>You will see some messages and recognize an address with: your node and your user ID. Below it, the URL you can use in your browser, which always starts with <code>127.0.0.1</code>. It will look like this, but in your case it might have a longer URL with a random <em>token</em> (mine is instead password protected):</p>

<img data-src="img/jupyterUrl.png" class="quarto-figure quarto-figure-center r-stretch" width="800"><p>&nbsp;</p>
<p>Write down your node number and user id you got from jupyterlab.</p>
<p><strong>We now need a tunnel</strong> from the local host (your PC)! Write in a new terminal <strong>(not logged into GenomeDK)</strong> a command like the following (matching the example figure above), substituting the correct values:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> <span class="at">-L6835:s21n34:6835</span> USERNAME@login.genome.au.dk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>&nbsp;</p>
<p>Your tunnel is now opened. The web application can be accessed <strong>from your browser</strong> at the address given by the server process on GenomeDK, which is <code>127.0.0.1/PORT_NUMBER</code> (put your correct port number).</p>
<p><strong>Exercise finished</strong></p>
</section>
<section class="slide level2">

<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Tip</strong></p>
</div>
<div class="callout-content">
<p>The same logic applies to all other web applications. They will have similar options to define the remote node and port.</p>
<p>Usually the host node option changes name between <code>ip</code>, <code>host</code>, <code>address</code>, or <code>hostname</code>.</p>
<p>&nbsp;</p>
<p>Note also that you will always have to use the address <code>127.0.0.1/PORT_NUMBER</code> on your browser. You might as well save it as a favorite address in your browser’s bookmarks.</p>
</div>
</div>
</div>
</section></section>
<section>
<section id="containers" class="title-slide slide level1 center">
<h1>Containers</h1>
<div title="What is a container">
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>What is a container</strong></p>
</div>
<div class="callout-content">
<p><strong>Container = </strong> Standalone and portable software package including</p>
<ul>
<li>code</li>
<li>runtime</li>
<li>libraries</li>
<li>system tools</li>
<li>operating system-level dependencies</li>
</ul>
</div>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>Deployment of a container on different HPCs and PCs is reproducible. A virtual environment (conda, mamba, pixi, cargo, npm, …) depends instead on the host system and is not necessarily fully reproducible on two different computer hardwares.</p>
</section>
<section id="container-vs-virtual-env-vs-vm" class="slide level2">
<h2>Container vs virtual env vs VM</h2>
<p>A <strong>virtual environment</strong> isolates dependencies for a specific programming language within the same operating system. It does not include the operating system or system-level dependencies, so it depends on the hosting system.</p>

<img data-src="img/containerVSconda.png" class="quarto-figure quarto-figure-center r-stretch" width="600"></section>
<section class="slide level2">

<ul>
<li>A <strong>virtual machine (VM)</strong> virtualizes an entire operating system, including the kernel, and runs on a hypervisor (assigns resources to the VM).</li>
</ul>

<img data-src="img/dockerAndVM.gif" class="quarto-figure quarto-figure-center r-stretch" width="600"></section>
<section id="scope-of-containers" class="slide level2">
<h2>Scope of containers</h2>
<ul>
<li><p>Containers are usually thought as packing a specific application which can run anywhere (or, which is portable).</p></li>
<li><p>E.g. annoying bioinformatics software requiring specific libraries or long installations.</p></li>
<li><p>Many containers are done with <em>Docker</em>, but this is not installed on GenomeDK</p></li>
<li><p>GenomeDK has <em>Singularity</em>, which can also run programs installed in Docker containers.</p></li>
<li><p>Very practical to <strong>pull and use</strong> containers <strong>in workflows</strong>.</p></li>
</ul>
</section>
<section id="where-to-find-containers" class="slide level2">
<h2>Where to find containers?</h2>
<p>Typical repositories with pre-built containers are:</p>
<ul>
<li><p><strong><a href="https://biocontainers.pro">Biocontainers</a></strong>: community-driven initiative to containerize bioinf softwares.</p>
<ul>
<li>x10K tools x100K+ containers</li>
<li><a href="https://bioconda.github.io/conda-package_index.html">bioconda package index</a> lists all software versions</li>
<li>the <a href="https://biocontainers.pro/registry">Registry page</a> has a searchable interface to find what you need</li>
</ul></li>
<li><p><strong><a href="https://hub.docker.com/">DockerHub</a></strong> registry: Public hub for Docker images, often including official containers from software developers</p></li>
<li><p><strong><a href="https://quay.io/">Quay</a></strong>: Same philosophy of DockerHub.</p></li>
</ul>
<p>Once you find a container on the websites, simply use (eventually adapt) the provided code to pull it locally.</p>
</section>
<section id="exercise-i-a-simple-bioinformatics-container" class="slide level2">
<h2>Exercise I: a simple bioinformatics container</h2>
<p>We use <em>biocontainers</em> to pull containers and recreate a little bulkRNA alignment. First <strong>create and attach to a new <code>tmux</code> session</strong> called <code>biocontainers</code>.</p>
<p>&nbsp;</p>
<p>Make a folder called <code>containers101</code> in the <code>advancedGDK</code> directory.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> advancedGDK/containers101</span>
<span id="cb28-2"><a aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> advancedGDK/containers101</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>&nbsp;</p>
<p>Find a bash bioinformatics software you know on the <a href="https://biocontainers.pro/registry">Biocontainer Registry</a> and open it to see a detailed description - if you have no good ideas look for the <code>minimap2</code> aligner. You should see a software documentation illustrating how to run the software in various ways - see next slide for a screenshot.</p>
</section>
<section class="slide level2">

<div class="quarto-figure quarto-figure-center">
<figure>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/minimap2Biocontainers.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Example: Biocontainers page for the minimap2 splice-aware aligner. Click on the image to enlarge."><img data-src="img/minimap2Biocontainers.png" class="quarto-figure quarto-figure-center" style="width:100.0%" alt="Example: Biocontainers page for the minimap2 splice-aware aligner. Click on the image to enlarge."></a></p>
</figure>
</div>
<figcaption>Example: Biocontainers page for the <code>minimap2</code> splice-aware aligner. Click on the image to enlarge.</figcaption>
</figure>
</div>
</section>
<section class="slide level2">

<p>The page will suggest to run immediately the container with <code>singularity</code>. I would suggest downloading it first (<code>pull</code> instead of <code>run</code>) and then running it.</p>
<p>In the case of <code>minimap2</code>:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">singularity</span> pull minimap2.sif https://depot.galaxyproject.org/singularity/minimap2:2.28--h577a1d6_4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>which creates a container file in your current directory, and calls it <code>minimap2.sif</code> (better name than the default <code>minimap2:2.28--h577a1d6_4</code>).</p>
<p>&nbsp;</p>
<p>You can either <code>run</code> the container, which opens a CLI into it, where you can execute the program. A non-interactive way (useful for pipelines) is to write the command directly. For example:</p>
<div class="columns">
<div class="column" style="width:50%;">
<p>This will operate the command line inside the container. Here you can then run <code>minimap2</code>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">singularity</span> run minimap2.sif</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column" style="width:50%;">
<p>This will immediately run <code>minimap2</code> from the container - useful for a pipeline where you do not need any interaction with the command line.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">singularity</span> run minimap2.sif minimap2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
</section>
<section id="exercise-ii-options-for-singularity" class="slide level2">
<h2>Exercise II: options for singularity</h2>
<p>Some containers are very easy to run. Some others need a lot of extra options, such as binding specific folders to a path, providing certificates, initializing environmental variables. A small example below:</p>
<h3 id="environment-variables">Environment variables</h3>
<p>The option <code>--env</code> can be used to define environment variables, either needed by your software, or useful to write the code to be executed.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a aria-hidden="true" tabindex="-1"></a> <span class="ex">singularity</span> pull samtools.sif https://depot.galaxyproject.org/singularity/samtools:1.21--h96c455f_1</span>
<span id="cb32-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a aria-hidden="true" tabindex="-1"></a> <span class="ex">singularity</span> run <span class="at">--env</span> REF_PATH=<span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span> <span class="dt">\</span></span>
<span id="cb32-4"><a aria-hidden="true" tabindex="-1"></a>                 <span class="at">--env</span> BAM_PREFIX=test01 <span class="dt">\</span></span>
<span id="cb32-5"><a aria-hidden="true" tabindex="-1"></a>                 samtools.sif <span class="dt">\</span></span>
<span id="cb32-6"><a aria-hidden="true" tabindex="-1"></a>                 samtools view <span class="dt">\</span></span>
<span id="cb32-7"><a aria-hidden="true" tabindex="-1"></a>                 <span class="at">-h</span> https://github.com/roryk/tiny-test-data/raw/refs/heads/master/wgs/mt.sorted.bam <span class="dt">\</span></span>
<span id="cb32-8"><a aria-hidden="true" tabindex="-1"></a>                 <span class="at">-O</span> bam <span class="op">&gt;</span> test01.bam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Ups, it does not work! Can you think of why?</strong> Hint: note that the address for the download of data begins with <code>https</code>.</p>
</section>
<section class="slide level2">

<h3 id="certificates-and-binding">Certificates and binding</h3>
<div title="Why the previous slide didn't work!!!">
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Why the previous slide didn’t work!!!</strong></p>
</div>
<div class="callout-content">
<p><strong>HTTPS</strong> is a protocol for secure communication over the internet. When you access an URL starting with <code>https</code>, your system checks the server’s SSL/TLS certificate to ensure it is issued by a trusted Certificate Authority (CA). Why? To prevent <a href="https://www.ibm.com/think/topics/man-in-the-middle">man-in-the-middle (MITM)</a> attacks, where an attacker eavesdrops in the data transfer.</p>
</div>
</div>
</div>
</div>
<p>The option <code>--bind</code> can be used to make your folders available in a specific path for the container. Here, we bind two folders containing the certificates for GDK. Those paths are quite standard across UNIX systems.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">singularity</span> run <span class="at">--env</span> REF_PATH=<span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span> <span class="dt">\</span></span>
<span id="cb33-2"><a aria-hidden="true" tabindex="-1"></a>                <span class="at">--env</span> BAM_PREFIX=test01 <span class="dt">\</span></span>
<span id="cb33-3"><a aria-hidden="true" tabindex="-1"></a>                <span class="at">--bind</span> /etc/ssl/certs:/etc/ssl/certs <span class="dt">\</span></span>
<span id="cb33-4"><a aria-hidden="true" tabindex="-1"></a>                <span class="at">--bind</span> /etc/pki/ca-trust:/etc/pki/ca-trust <span class="dt">\</span></span>
<span id="cb33-5"><a aria-hidden="true" tabindex="-1"></a>                samtools.sif <span class="dt">\</span></span>
<span id="cb33-6"><a aria-hidden="true" tabindex="-1"></a>                samtools view <span class="dt">\</span></span>
<span id="cb33-7"><a aria-hidden="true" tabindex="-1"></a>                <span class="at">-h</span> https://github.com/roryk/tiny-test-data/raw/refs/heads/master/wgs/mt.sorted.bam <span class="dt">\</span></span>
<span id="cb33-8"><a aria-hidden="true" tabindex="-1"></a>                <span class="at">-O</span> bam <span class="op">&gt;</span> <span class="va">$BAM_PREFIX</span>.bam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="exercise-finished" class="slide level2">
<h2><strong>Exercise finished</strong></h2>
<p>A few other options which can be used in singularity. When you need those really depends on the application:</p>
<ul>
<li><p><code>--fakeroot</code>: Allows running the container with root privileges in a user namespace. Useful for containers that require root access without needing actual root privileges.</p></li>
<li><p><code>--writable</code>: Enables writing to the container image. This is useful for making changes to the container, but it requires the container to be writable. <code>--writable-tmpfs</code> to avoid changes to be persistent in a non-writable container.</p></li>
<li><p><code>--contain</code>: Isolates the container from the host system by limiting access to the host’s filesystem.</p></li>
<li><p><code>--no-home</code>: Prevents the container from automatically binding the user’s home directory. Avoids exposing your home directory to the container.</p></li>
<li><p><code>--cleanenv</code>: Clears all environment variables except those explicitly set for the container.</p></li>
<li><p><code>--nv</code>: Enables NVIDIA GPU support by binding the necessary libraries and drivers. Equivalent for AMD GPUs is <code>--rocm</code> (not the case on GDK).</p></li>
<li><p><code>--pwd</code>: Sets the working directory inside the container.</p></li>
</ul>
</section></section>
<section>
<section id="your-first-pipeline" class="title-slide slide level1 center">
<h1>Your first pipeline</h1>
<ul>
<li>An example pipeline</li>
<li>parallelizing</li>
<li>templates</li>
<li>environments and containers</li>
<li>resource usage</li>
</ul>
</section>
<section id="split-and-merge" class="slide level2">
<h2>Split and merge</h2>
<p>A classical bioinformatics pipeline has splits and merge steps. We will work with this:</p>
<div class="cell" data-reveal="true" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class=""><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
  A0{data.fq} --&gt; A["Split(data.fq)"]
  A --&gt; B["table(part000.fq)"]
  A --&gt; C["table(part002.fq)"]
  A --&gt; D["table(part....fq)"]
  A --&gt; E["table(part009.fq)"]
  B --&gt; F["merge(table_[000-009].tsv)"]
  C --&gt; F
  D --&gt; F
  E --&gt; F
  F --&gt; G{table.tsv}
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>where <code>split</code> and <code>table</code> (generate allele counts and statistics in a table) are done through <code>seqkit</code>.</p>
</section>
<section id="software-gwf" class="slide level2">
<h2>Software: gwf</h2>
<p>There are many populare softwares for workflows (<code>Snakemake</code>, <code>Nextflow</code>), which requires learning their workflow language. We use instead <code>gwf</code>:</p>
<ul>
<li>Developed at AU (Dan at GenomeDK) and used also at MOMA, AUH, …
<ul>
<li>Easy to find support</li>
</ul></li>
<li>In python, no need for new language
<ul>
<li>You can use all python functions to build your workflow!</li>
</ul></li>
<li>Easy to structure a workflow and check resource usage
<ul>
<li>Reusable templates</li>
<li>Very pedagogical</li>
</ul></li>
<li>Conda, Pixi, Container usage out-of-the-box</li>
</ul>
<p>&nbsp;</p>
<p>Once you understand workflows with <code>gwf</code>, it is a matter of learning how to use other workflow languages, if you wish.</p>
</section>
<section class="slide level2">

<h3 id="workflow-objects-in-gwf">Workflow objects in gwf</h3>
<p>The whole workflow is contained in a <code>Workflow</code> object. This is initiated usually like this:</p>
<p>&nbsp;</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a aria-hidden="true" tabindex="-1"></a><span class="co">#import libraries</span></span>
<span id="cb34-2"><a aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gwf <span class="im">import</span> <span class="op">*</span></span>
<span id="cb34-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a aria-hidden="true" tabindex="-1"></a><span class="co">#initiate a workflow object</span></span>
<span id="cb34-5"><a aria-hidden="true" tabindex="-1"></a>gwf <span class="op">=</span> Workflow( )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>&nbsp;</p>
<div title="Using project resources">
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Using project resources</strong></p>
</div>
<div class="callout-content">
<p>Now you have an empty workflow, which will use the few free resources each user has available. Resources from a project you are part of can be created using instead</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a aria-hidden="true" tabindex="-1"></a>gwf <span class="op">=</span> Workflow( defaults<span class="op">=</span>{<span class="st">"account"</span>: <span class="st">"PROJECT_NAME"</span>} )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="templates-in-gwf">Templates in gwf</h3>
<p>Now you can populate your <code>Workflow</code> object with <code>templates</code>, which are simple python functions. You can create <em>executors</em> for your templates (environments and containers, which will run the programs you need)!</p>
<p>The <strong>template is a blueprint for a specific block of the workflow</strong>.</p>
<p>For example, the 10 parallel table blocks can be described by one reusable template:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a aria-hidden="true" tabindex="-1"></a><span class="co">#create a software executor from conda environment `seqkitEnv`</span></span>
<span id="cb36-2"><a aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gwf.executors <span class="im">import</span> Conda</span>
<span id="cb36-3"><a aria-hidden="true" tabindex="-1"></a>conda_env <span class="op">=</span> Conda(<span class="st">"seqkitEnv"</span>)</span>
<span id="cb36-4"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> table(infile): <span class="co">#Name of the template</span></span>
<span id="cb36-6"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a aria-hidden="true" tabindex="-1"></a>  inputs  <span class="op">=</span> [infile]  <span class="co">#input file(s)</span></span>
<span id="cb36-8"><a aria-hidden="true" tabindex="-1"></a>  outputs <span class="op">=</span> [<span class="ss">f"</span><span class="sc">{</span>infile<span class="sc">}</span><span class="ss">.fx2tab.tsv"</span>] <span class="co">#name of the output(s)</span></span>
<span id="cb36-9"><a aria-hidden="true" tabindex="-1"></a>  options <span class="op">=</span> {<span class="st">"cores"</span>: <span class="dv">1</span>, <span class="st">"memory"</span>: <span class="st">"1g"</span>, <span class="st">"walltime"</span>: <span class="st">"02:00:00"</span>} <span class="co">#resources to use</span></span>
<span id="cb36-10"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a aria-hidden="true" tabindex="-1"></a>  <span class="co">#the bash commands to run when using the template</span></span>
<span id="cb36-12"><a aria-hidden="true" tabindex="-1"></a>  spec <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb36-13"><a aria-hidden="true" tabindex="-1"></a><span class="ss">  seqkit fx2tab -n -l -C A -C C -C G -C T -C N -g -G -s </span><span class="sc">{</span>infile<span class="sc">}</span><span class="ss"> &gt; </span><span class="sc">{</span>outputs[<span class="dv">0</span>]<span class="sc">}</span></span>
<span id="cb36-14"><a aria-hidden="true" tabindex="-1"></a><span class="ss">  """</span></span>
<span id="cb36-15"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a aria-hidden="true" tabindex="-1"></a>  <span class="co">#here you provide all specifications defined in the template. </span></span>
<span id="cb36-17"><a aria-hidden="true" tabindex="-1"></a>  <span class="co">#This is usually always as below, </span></span>
<span id="cb36-18"><a aria-hidden="true" tabindex="-1"></a>  <span class="co">#apart from the executor, which you decide yourself</span></span>
<span id="cb36-19"><a aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> AnonymousTarget(inputs<span class="op">=</span>inputs, outputs<span class="op">=</span>outputs, options<span class="op">=</span>options, spec<span class="op">=</span>spec, executor<span class="op">=</span>conda_env)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

<h3 id="apply-the-template">Apply the template</h3>
<p>The <code>split</code> and <code>table</code> templates are then applied to the relevant files:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a aria-hidden="true" tabindex="-1"></a>parts<span class="op">=</span><span class="dv">10</span> <span class="co">#how many parts to split into</span></span>
<span id="cb37-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the split template to data.fq to split in 10 parts. Call this step of the workflow "split"</span></span>
<span id="cb37-4"><a aria-hidden="true" tabindex="-1"></a><span class="co"># T1 collects info of the workflow step (e.g. output names)</span></span>
<span id="cb37-5"><a aria-hidden="true" tabindex="-1"></a>T1 <span class="op">=</span> gwf.target_from_template(<span class="st">"split"</span>, split(infile<span class="op">=</span><span class="st">"data.fq"</span>, parts<span class="op">=</span>parts))</span>
<span id="cb37-6"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Tabulate each part of the splitting and save the name of the tables in</span></span>
<span id="cb37-8"><a aria-hidden="true" tabindex="-1"></a><span class="co"># seqkit_output_files. We apply the template table to each input file of the</span></span>
<span id="cb37-9"><a aria-hidden="true" tabindex="-1"></a><span class="co"># for loop. The step of the workflow is called table_1, table_2, ..., table_10</span></span>
<span id="cb37-10"><a aria-hidden="true" tabindex="-1"></a>seqkit_output_files <span class="op">=</span> []</span>
<span id="cb37-11"><a aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, infile <span class="kw">in</span> <span class="bu">enumerate</span>(T1.outputs):</span>
<span id="cb37-12"><a aria-hidden="true" tabindex="-1"></a>   T2 <span class="op">=</span> gwf.target_from_template(<span class="ss">f"table_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>, table(infile  <span class="op">=</span> infile))</span>
<span id="cb37-13"><a aria-hidden="true" tabindex="-1"></a>   seqkit_output_files.append(T2.outputs[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We try out exactly those template in the following exercise.</p>
</section>
<section id="exercise-i-workflow-with-conda-containers" class="slide level2">
<h2>Exercise I: workflow with conda containers</h2>
<p>Prepare everything for the exercise: create a <strong>new folder</strong>, get <strong>data and workflow file</strong></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb38-1"><a aria-hidden="true" tabindex="-1"></a> <span class="fu">mkdir</span> <span class="at">-p</span> advancedGDK/pipeline</span>
<span id="cb38-2"><a aria-hidden="true" tabindex="-1"></a> <span class="bu">cd</span> advancedGDK/pipeline</span>
<span id="cb38-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a aria-hidden="true" tabindex="-1"></a> <span class="fu">wget</span> https://github.com/hds-sandbox/GDKworkshops/raw/refs/heads/main/Examples/smallGwf/data.fq <span class="at">-O</span> data.fq</span>
<span id="cb38-5"><a aria-hidden="true" tabindex="-1"></a> <span class="fu">wget</span> https://github.com/hds-sandbox/GDKworkshops/raw/refs/heads/main/Examples/smallGwf/workflow.py <span class="at">-O</span> workflow.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

<p>Create a conda environment for <code>seqkit</code> and one for the <code>gwf</code> workflow software. Download the <code>seqkit</code> container as well.</p>
<p>&nbsp;</p>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Tip</strong></p>
</div>
<div class="callout-content">
<p>If packages cannot be found, you need to add these default channels as well</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb39-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> config <span class="at">--add</span> channels bioconda</span>
<span id="cb39-2"><a aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> config <span class="at">--add</span> channels conda-forge</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>&nbsp;</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb40-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> config <span class="at">--add</span> channels gwforg</span>
<span id="cb40-2"><a aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> create <span class="at">-y</span> <span class="at">-n</span> pipelineEnv gwf=2.1.1</span>
<span id="cb40-3"><a aria-hidden="true" tabindex="-1"></a><span class="co">#package for resource usage/check</span></span>
<span id="cb40-4"><a aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> install <span class="at">-y</span> <span class="at">-n</span> pipelineEnv <span class="at">-c</span> micknudsen gwf-utilization</span>
<span id="cb40-5"><a aria-hidden="true" tabindex="-1"></a><span class="co">#env for seqkit</span></span>
<span id="cb40-6"><a aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> create <span class="at">-y</span> <span class="at">-n</span> seqkitEnv seqkit</span>
<span id="cb40-7"><a aria-hidden="true" tabindex="-1"></a><span class="co">#Container</span></span>
<span id="cb40-8"><a aria-hidden="true" tabindex="-1"></a><span class="ex">singularity</span> pull seqkit_2.10.0  https://depot.galaxyproject.org/singularity/seqkit:2.10.0--h9ee0642_0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

<p>Now look at the <code>status</code> of your workflow. You should recognize all the steps (<em>targets</em>). Those are marked <code>shouldrun</code>, because the outputs and/or inputs are not existent. Remember to activate the environment for <code>gwf</code>.</p>
<p>&nbsp;</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb41-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> activate pipelineEnv</span>
<span id="cb41-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> <span class="at">-f</span> workflow.py status</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<img data-src="img/status0.png" class="quarto-figure quarto-figure-center r-stretch" width="500"><p>&nbsp;</p>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Tip</strong></p>
</div>
<div class="callout-content">
<p>You do not need <code>-f workflow.py</code> if your workflow file has the name <code>workflow.py</code>, which is the default for <code>gwf</code>.</p>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>Now, you might also want to look at how a specific <em>target</em> looks like when the workflow is built</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb42-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> info split</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You will be able to see the actual inputs, outputs, and other targets it depends from/depending on it:</p>
<div class="sourceCode" id="cb43" data-code-line-numbers="4-7|10|13-22|24|25|27-36"><pre class="sourceCode numberSource python scrollable number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a></a>{</span>
<span id="cb43-2"><a></a>    <span class="st">"split"</span>: {</span>
<span id="cb43-3"><a></a>        <span class="st">"options"</span>: {</span>
<span id="cb43-4"><a></a>            <span class="st">"cores"</span>: <span class="dv">1</span>,</span>
<span id="cb43-5"><a></a>            <span class="st">"memory"</span>: <span class="st">"4g"</span>,</span>
<span id="cb43-6"><a></a>            <span class="st">"walltime"</span>: <span class="st">"05:00:00"</span></span>
<span id="cb43-7"><a></a>        },</span>
<span id="cb43-8"><a></a>        <span class="st">"inputs"</span>: [</span>
<span id="cb43-9"><a></a>            <span class="st">"data.fq"</span></span>
<span id="cb43-10"><a></a>        ],</span>
<span id="cb43-11"><a></a>        <span class="st">"outputs"</span>: [</span>
<span id="cb43-12"><a></a>            <span class="st">"gwf_splitted/part001.fq"</span>,</span>
<span id="cb43-13"><a></a>            <span class="st">"gwf_splitted/part002.fq"</span>,</span>
<span id="cb43-14"><a></a>            <span class="st">"gwf_splitted/part003.fq"</span>,</span>
<span id="cb43-15"><a></a>            <span class="st">"gwf_splitted/part004.fq"</span>,</span>
<span id="cb43-16"><a></a>            <span class="st">"gwf_splitted/part005.fq"</span>,</span>
<span id="cb43-17"><a></a>            <span class="st">"gwf_splitted/part006.fq"</span>,</span>
<span id="cb43-18"><a></a>            <span class="st">"gwf_splitted/part007.fq"</span>,</span>
<span id="cb43-19"><a></a>            <span class="st">"gwf_splitted/part008.fq"</span>,</span>
<span id="cb43-20"><a></a>            <span class="st">"gwf_splitted/part009.fq"</span>,</span>
<span id="cb43-21"><a></a>            <span class="st">"gwf_splitted/part010.fq"</span></span>
<span id="cb43-22"><a></a>        ],</span>
<span id="cb43-23"><a></a>        <span class="st">"spec"</span>: <span class="st">"</span><span class="ch">\n</span><span class="st">    seqkit split2 -O gwf_splitted --by-part 10 --by-part-prefix part data.fq</span><span class="ch">\n</span><span class="st">    "</span>,</span>
<span id="cb43-24"><a></a>        <span class="st">"dependencies"</span>: [],</span>
<span id="cb43-25"><a></a>        <span class="st">"dependents"</span>: [</span>
<span id="cb43-26"><a></a>            <span class="st">"table_6"</span>,</span>
<span id="cb43-27"><a></a>            <span class="st">"table_8"</span>,</span>
<span id="cb43-28"><a></a>            <span class="st">"table_3"</span>,</span>
<span id="cb43-29"><a></a>            <span class="st">"table_0"</span>,</span>
<span id="cb43-30"><a></a>            <span class="st">"table_1"</span>,</span>
<span id="cb43-31"><a></a>            <span class="st">"table_4"</span>,</span>
<span id="cb43-32"><a></a>            <span class="st">"table_5"</span>,</span>
<span id="cb43-33"><a></a>            <span class="st">"table_9"</span>,</span>
<span id="cb43-34"><a></a>            <span class="st">"table_7"</span>,</span>
<span id="cb43-35"><a></a>            <span class="st">"table_2"</span></span>
<span id="cb43-36"><a></a>        ]</span>
<span id="cb43-37"><a></a>    }</span>
<span id="cb43-38"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Tip</strong></p>
</div>
<div class="callout-content">
<p>Do you want to see the whole workflow in a text editor? Use the <code>less</code> viewer,</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb44-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> info <span class="kw">|</span> <span class="fu">less</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>or output into a text file:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb45-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> info <span class="op">&gt;</span> workflow_explicit.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>Now, you can run specific targets. Let’s specify some names to test out our workflow.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb46-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> run split table_0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Tip</strong></p>
</div>
<div class="callout-content">
<p>You can run the entire workflow with <code>gwf run</code> when you are sure of your targets working correctly with the right resources.</p>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>Check the status: the two turgets will be <code>submitted</code>, then <code>split</code> has to run first, and its <em>dependency</em> <code>table_0</code> will run when the file <code>part_001.fq</code> is generated! We use <code>watch</code> in front of the command to update its view every two seconds.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb47-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">watch</span> gwf status</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>&nbsp;</p>
<p>At some point, you will see the <code>running</code> status (for a few seconds) and <code>completed</code> status.</p>

<img data-src="img/gwfCompleted.png" class="quarto-figure quarto-figure-center r-stretch" width="500"><p><strong>Exercise break</strong></p>
</section>
<section class="slide level2">

<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Tip</strong></p>
</div>
<div class="callout-content">
<p>When the status of a target is <code>failed</code>, or you want to verify messages on the command line, you can visualize the standard output and standard error messages of your target with the commands below (example with the <code>split</code> target):</p>
<p>&nbsp;</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb48-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> logs split </span>
<span id="cb48-2"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> logs <span class="at">-e</span> split</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="resize-the-workflow-resources-and-add-a-step">Resize the workflow resources and add a step</h3>
<p>How many resources did <code>split</code> and <code>table_0</code> use? Run the utilization command:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb49-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> utilization</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<img data-src="img/gwfUtilization.png" class="quarto-figure quarto-figure-center r-stretch" width="1000"><p>&nbsp;</p>
<p>The table shows we underutilized the resources. Now open <code>workflow.py</code> and change your resource usage for the <code>split</code> and <code>table_</code> steps. Then, run the target:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb50-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> run table_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>&nbsp;</p>
<p>Check again resource usage when the status is <code>completed</code>. Did it get better?</p>
<p><strong>Exercise break</strong></p>
</section>
<section id="exercise-ii-singularity-in-workflows" class="slide level2 scrollable">
<h2>Exercise II: singularity in workflows</h2>
<p>Now, you will change the executor for the template <code>table</code>. Your task is to:</p>
<ul>
<li><p>open the <code>workflow.py</code> file</p></li>
<li><p>below importing the <code>Conda</code> module (line 2), add a new line with</p>
<p><code>from gwf.executors import Singularity</code></p></li>
<li><p>Now, define a new executor. Below the line where you define <code>conda_env = Conda("seqkitEnv")</code>, use a similar syntax for <code>Singularity</code>, where you provide the container file as argument.</p></li>
<li><p>At the end of the <code>align</code> template, use the new executor instead of <code>conda_env</code>.</p></li>
</ul>
<p>&nbsp;</p>
<p>Did you do it right? If yes, then you should be able to run the <code>combine</code> target:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb51-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> run combine</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and see its status become <code>completed</code> after some time, and all output files should be created in your folder! If not, something is wrong. Ask for help, or <a href="https://raw.githubusercontent.com/hds-sandbox/GDKworkshops/refs/heads/main/Examples/smallGwf/workflow_container.py">look at the solution file, if you prefere</a>.</p>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Because <code>combine</code> depends on all <code>table_</code> targets, it will submit all those targets as well, which need to run first.</p>
</div>
</div>
</div>
<p><strong>Exercise break</strong></p>
</section>
<section id="exercise-iii-your-own-target" class="slide level2 scrollable">
<h2>Exercise III: Your own target!</h2>
<p>Ok, now we want to extend the workflow and do quality control on the <code>part_###.fq</code> files.</p>
<div class="cell" data-reveal="true" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class=""><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
  A0{data.fq} --&gt; A["Split(data.fq)"]
  A --&gt; B["table(part000.fq)"]
  A --&gt; C["table(part002.fq)"]
  A --&gt; D["table(part....fq)"]
  A --&gt; E["table(part009.fq)"]
  B --&gt; F["merge(table_[000-009].tsv)"]
  C --&gt; F
  D --&gt; F
  E --&gt; F
  F --&gt; G{table.tsv}
  B --&gt; H["qc(part[000-009].fq)"]
  C --&gt; H
  D --&gt; H
  E --&gt; H
  H --&gt; I{"multiqc_report.html"}
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>You need to:</p>
<ul>
<li>create a new environment called <code>qcEnv</code> where you install the two packages <code>fastqc multiqc</code>.</li>
<li>add a new executor called <code>qc_env</code> based on <code>Conda("qcEnv")</code>.</li>
<li>create a new target which starts with <code>def qc(data_folder)</code>
<ul>
<li><p>this will need all ten <code>gwf_splitted/part_###.fq</code> file as input files (you can copy the output file list of the <code>split</code> template, where you use a variable <code>{data_folder}</code> instead of the explicit folder name!)</p></li>
<li><p>as output you want a file called <code>[reports/multiqc_report.html]</code> (default name for the generated report)</p></li>
<li><p>as bash commands you need:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb52-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> reports</span>
<span id="cb52-2"><a aria-hidden="true" tabindex="-1"></a><span class="ex">fastqc</span> <span class="at">-o</span> reports gdk_splitted/<span class="pp">*</span>.fq</span>
<span id="cb52-3"><a aria-hidden="true" tabindex="-1"></a><span class="ex">multiqc</span> <span class="at">-o</span> reports reports/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>remember to set the correct executor at the end of the template</p></li>
<li><p>now you need to create one single target from the template, call it <code>qc</code>. You only need to give as input the name of the folder with the <code>fq</code> files</p></li>
</ul></li>
</ul>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Tip</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Before running any targets, always use <code>gwf info qc</code> to check dependencies.</li>
<li>Copy previous similar templates and modify them where needed, instead of writing each template from scratch</li>
</ul>
</div>
</div>
</div>
<p>When you are sure you are done, then use <code>gwf run qc</code>. Its <code>status</code> should be <code>comlpeted</code> if it runs successfully.</p>
<p>Ask for help, or <a href="https://raw.githubusercontent.com/hds-sandbox/GDKworkshops/refs/heads/main/Examples/smallGwf/workflow_qc.py">look at the solution file, if you prefere</a>.</p>
<p><strong>Exercise break</strong></p>
</section>
<section class="slide level2">

<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Good practices:</p>
<ul>
<li>do not make tiny and numerous jobs, try to put together things with similar resource usage</li>
<li>start testing one of many parallel elements of a worlflow
<ul>
<li>determine resource usage (<code>gwf utilization</code> - needs a plugin, see earlier exercises)</li>
<li>adjust your templates’ resources accordingly</li>
</ul></li>
<li>verify often your code is correct
<ul>
<li><code>gwf info target_name</code> to check dependencies</li>
<li>remember you are using python, check some of your code directly in it!</li>
</ul></li>
<li>when done, you are reproducible if you share with your datasets:
<ul>
<li>container pull commands</li>
<li>conda environment(s) package list</li>
<li>workflow files</li>
</ul></li>
</ul>
</div>
</div>
</div>
</section></section>
<section>
<section id="closing-the-workshop" class="title-slide slide level1 center">
<h1>Closing the workshop</h1>
<p>Please fill out this form :)</p>
<iframe src="https://docs.google.com/forms/d/e/1FAIpQLSfImYVZLrmBG_Z54sy1Au_jRwneg4Pjnenh36J34x9SYttSoQ/viewform?embedded=true" width="640" height="640" frameborder="0" marginheight="0" marginwidth="0">
Indlæser…
</iframe>
</section>
<section class="slide level2">

<ul>
<li><p>A lot of things we could not cover</p></li>
<li><p>use the official documentation!</p></li>
<li><p>ask for help, use drop in hours (<a href="https://abc.au.dk">ABC cafe</a>)</p></li>
<li><p>try out stuff and google yourself out of small problems</p></li>
<li><p>Slides updated over time, use as a reference</p></li>
<li><p>Next workshop all about pipelines</p></li>
</ul>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="img/logos.png" class="slide-logo"></p>
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': true,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'h.v',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/hds-sandbox\.github\.io\/GDKworkshops\/");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    <script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
    (function() {
      let previousOnload = window.onload;
      window.onload = () => {
        if (previousOnload) {
          previousOnload();
        }
        lightboxQuarto.on('slide_before_load', (data) => {
          const { slideIndex, slideNode, slideConfig, player, trigger } = data;
          const href = trigger.getAttribute('href');
          if (href !== null) {
            const imgEl = window.document.querySelector(`a[href="${href}"] img`);
            if (imgEl !== null) {
              const srcAttr = imgEl.getAttribute("src");
              if (srcAttr && srcAttr.startsWith("data:")) {
                slideConfig.href = srcAttr;
              }
            }
          } 
        });
      
        lightboxQuarto.on('slide_after_load', (data) => {
          const { slideIndex, slideNode, slideConfig, player, trigger } = data;
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(slideNode);
          }
        });
      
      };
      
    })();
              </script>
    

</body></html>