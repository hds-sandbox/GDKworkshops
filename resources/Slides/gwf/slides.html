<!DOCTYPE html>
<html lang="en"><head>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <meta name="author" content="Samuele Soraggi">
  <meta name="author" content="Dan Søndergaard">
  <meta name="dcterms.date" content="2024-04-09">
  <title>GenomeDK workshops – Introduction to workflows with gwf</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/theme/quarto-bbe7401fe57d4b791b917637bb662036.css">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-QZP3HK6BQT"></script>

  <script type="text/javascript">

  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-QZP3HK6BQT', { 'anonymize_ip': true});
  </script>
  <link href="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Introduction to workflows with gwf</h1>
  <p class="subtitle">https://hds-sandbox.github.io/GDKworkshops</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Samuele Soraggi 
</div>
        <p class="quarto-title-affiliation">
            Health Data Science sandbox, BiRC
          </p>
    </div>
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Dan Søndergaard 
</div>
        <p class="quarto-title-affiliation">
            GenomeDK, Health
          </p>
    </div>
</div>

  <p class="date">2024-04-09</p>
</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#/short-on-workflows-and-gwf" id="/toc-short-on-workflows-and-gwf">Short on Workflows and gwf</a></li>
<li><a href="#/exercise-setup" id="/toc-exercise-setup">Exercise setup</a></li>
<li><a href="#/a-single-target-workflow" id="/toc-a-single-target-workflow">A single target Workflow</a></li>
<li><a href="#/parallel-targets" id="/toc-parallel-targets">Parallel targets</a></li>
<li><a href="#/multiple-target-dependencies" id="/toc-multiple-target-dependencies">Multiple target dependencies</a></li>
<li><a href="#/exercise-1" id="/toc-exercise-1">Exercise 1</a></li>
<li><a href="#/exercise-2" id="/toc-exercise-2">Exercise 2</a></li>
<li><a href="#/clean-up-after-yourself" id="/toc-clean-up-after-yourself">Clean up after yourself</a></li>
<li><a href="#/last-tips" id="/toc-last-tips">Last tips</a></li>
</ul>
</nav>
</section>
<section>
<section id="short-on-workflows-and-gwf" class="title-slide slide level1 center">
<h1>Short on Workflows and gwf</h1>

</section>
<section id="workflow" class="slide level2">
<h2>Workflow</h2>

<img data-src="img/small_pipeline.png" class="quarto-figure quarto-figure-center r-stretch"><div title="Workflow and W. Management System">
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Workflow and W. Management System</strong></p>
</div>
<div class="callout-content">
<p>A <strong>workflow</strong> is a series of calculations and data manipulations which have to be performed in a specific sequence. A <strong>workflow management system</strong> organizes the workflow steps through defined dependencies, can assign different computing resources to each step, keeps a log of the workflow, interacts with a cluster’s queueing system.</p>
</div>
</div>
</div>
</div>
</section>
<section id="a-few-terms" class="slide level2">
<h2>A few terms</h2>

<img data-src="img/small_pipeline_terms.png" class="quarto-figure quarto-figure-center r-stretch"><p>Each target of the workflow is <strong>submitted</strong> to a queueing manager so that it enters the queue and can be executed when possible.</p>
</section>
<section id="gwf" class="slide level2">
<h2>Gwf</h2>
<p>A lightweight and easy to adopt workflow manager. it requires knowing or learning <code>Python</code>. Some useful features:</p>
<ul>
<li>Defines <strong>target dependencies automatically</strong> using the input and output files of targets</li>
<li>Only submits targets when their output files are <strong>not up to date</strong></li>
<li>Fire-and-forget: once you submit targets, you need <strong>not do more</strong></li>
<li>Has a few, simple and useful commands for <strong>following workflow execution</strong> and <strong>cleaning up</strong> intermediate data files</li>
</ul>
<p>Check out <a href="https://gwf.app/">the gwf webpage</a> for updates, examples and more detailed documentation.</p>
</section></section>
<section>
<section id="exercise-setup" class="title-slide slide level1 center">
<h1>Exercise setup</h1>
<p>Data and inspiration from <a href="https://datacarpentry.org/wrangling-genomics/index.html">this SW carpentry bioinformatics tutorial</a>, which does not use pipelines.</p>

<img data-src="img/whole_gwf.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="download-examples-and-data" class="slide level2">
<h2>Download examples and data</h2>
<p>Examples and reference file</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-L</span> <span class="at">-o</span> gwf_workshop.zip https://github.com/hds-sandbox/GDKworkshops/archive/main.zip <span class="dt">\</span></span>
<span id="cb1-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="kw">&amp;&amp;</span> <span class="fu">unzip</span> gwf_workshop.zip <span class="dt">\</span></span>
<span id="cb1-3"><a aria-hidden="true" tabindex="-1"></a>    <span class="kw">&amp;&amp;</span> <span class="fu">mv</span> GDKworkshops-main/Examples/gwf gwf_workshop <span class="dt">\</span></span>
<span id="cb1-4"><a aria-hidden="true" tabindex="-1"></a>    <span class="kw">&amp;&amp;</span> <span class="fu">rm</span> <span class="at">-rf</span> GDKworkshops-main gwf_workshop.zip</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Download fastq files</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> gwf_workshop/data</span>
<span id="cb2-2"><a aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> gwf_workshop/data/</span>
<span id="cb2-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-O</span> ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR258/004/SRR2589044/SRR2589044_1.fastq.gz</span>
<span id="cb2-5"><a aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-O</span> ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR258/004/SRR2589044/SRR2589044_2.fastq.gz</span>
<span id="cb2-6"><a aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-O</span> ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR258/003/SRR2584863/SRR2584863_1.fastq.gz</span>
<span id="cb2-7"><a aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-O</span> ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR258/003/SRR2584863/SRR2584863_2.fastq.gz</span>
<span id="cb2-8"><a aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-O</span> ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR258/006/SRR2584866/SRR2584866_1.fastq.gz</span>
<span id="cb2-9"><a aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-O</span> ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR258/006/SRR2584866/SRR2584866_2.fastq.gz</span>
<span id="cb2-10"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ..</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

<p>Final file structure (run the <code>tree</code> command)</p>

<img data-src="img/tree_download.png" class="r-stretch"></section>
<section id="install-gwf" class="slide level2">
<h2>Install gwf</h2>
<p>Using conda to create a new environment from the <code>yml</code> file:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> env create <span class="at">-n</span> gwf_workshop <span class="at">-f</span> Environments/gwf_workshop.yml</span>
<span id="cb3-2"><a aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> activate gwf_workshop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can see the package list with</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> Environments/gwf_workshop.yml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<p>The whole environment dependencies and versions can be seen with</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section>
<section id="a-single-target-workflow" class="title-slide slide level1 center">
<h1>A single target Workflow</h1>

<img data-src="img/simple_gwf.png" class="quarto-figure quarto-figure-center r-stretch"><p>The workflow file can be printed out with</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">less</span> <span class="at">-S</span> WF01_report.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Exit using <code>q</code></p>
</section>
<section class="slide level2">

<p>You can easily spot all the elements of a workflow graph:</p>
<div class="sourceCode" id="cb7" data-code-line-numbers="1-3|6|7-9|10-12|13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a></a><span class="im">from</span> gwf <span class="im">import</span> Workflow</span>
<span id="cb7-2"><a></a></span>
<span id="cb7-3"><a></a>gwf <span class="op">=</span> Workflow(defaults<span class="op">=</span>{<span class="st">'account'</span>: <span class="st">'your_project'</span>})</span>
<span id="cb7-4"><a></a></span>
<span id="cb7-5"><a></a><span class="co">## A target doing FastQC on a file</span></span>
<span id="cb7-6"><a></a>gwf.target(<span class="st">'FastQC'</span>, </span>
<span id="cb7-7"><a></a>           cores<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb7-8"><a></a>           memory<span class="op">=</span><span class="st">'8gb'</span>,</span>
<span id="cb7-9"><a></a>           walltime<span class="op">=</span><span class="st">'00:05:00'</span>, </span>
<span id="cb7-10"><a></a>           inputs<span class="op">=</span>[<span class="st">'data/SRR2584863_1.fastq.gz'</span>], </span>
<span id="cb7-11"><a></a>           outputs<span class="op">=</span>[<span class="st">'data/SRR2584863_1_fastqc.html'</span>, </span>
<span id="cb7-12"><a></a>                    <span class="st">'data/SRR2584863_1_fastqc.zip'</span>]) <span class="op">&lt;&lt;</span> <span class="st">""" </span></span>
<span id="cb7-13"><a></a><span class="st">fastqc data/SRR2584863_1.fastq.gz</span></span>
<span id="cb7-14"><a></a><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="status-and-submission" class="slide level2">
<h2>Status and submission</h2>
<p>We can see what is the status of each target - if it doesn’t see the output files (<code>shouldrun</code>), if the output is there (<code>completed</code>), if it is executing a target (<code>running</code>), or if it failed (‘failed’).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> <span class="at">-f</span> WF01_report.py status</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>will show</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">⨯</span> FastQC        shouldrun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<p>You can submit the targets with</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> <span class="at">-f</span> WF01_report.py run</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>which reports you</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">Submitting</span> target FastQC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>Look again at the status. You can follow it up in real-time using <code>watch</code> (it will lose the nice colour formatting):</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">watch</span> gwf <span class="at">-f</span> WF01_report.py status</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You might see it going from <code>submitted</code> to <code>running</code> and <code>completed</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">✓</span> FastQC        completed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="targets-stdout-and-stderr" class="slide level2">
<h2>Targets stdout and stderr</h2>
<p>What are the commands in a target outputting? You can see <code>stdout</code> and <code>stderr</code> in the log of a target:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> <span class="at">-f</span> WF01_report.py logs FastQC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> <span class="at">-f</span> WF01_report.py logs <span class="at">-e</span> FastQC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section></section>
<section>
<section id="parallel-targets" class="title-slide slide level1 center">
<h1>Parallel targets</h1>

<img data-src="img/whole_gwf_1.png" class="r-stretch quarto-figure-center"><p class="caption">Define independent targets which can run <strong>at the same time</strong> in the workflow</p></section>
<section class="slide level2">

<p>You can use python to automatically parsing names in a folder and creating targets:</p>
<div class="sourceCode" id="cb16" data-code-line-numbers="1-5|8|9-10|10-12|16-18|19-20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a></a><span class="co">#find .fastq.gz files in the data folder</span></span>
<span id="cb16-2"><a></a>pattern <span class="op">=</span> os.path.join(<span class="st">'data'</span>, <span class="st">'*.fastq.gz'</span>)</span>
<span id="cb16-3"><a></a>fastq_files <span class="op">=</span> glob.glob(pattern) </span>
<span id="cb16-4"><a></a><span class="co">#keep only the file name without the folder path</span></span>
<span id="cb16-5"><a></a>fastq_files <span class="op">=</span> [os.path.basename(<span class="bu">file</span>) <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> fastq_files] <span class="co">#remove the path from the file</span></span>
<span id="cb16-6"><a></a></span>
<span id="cb16-7"><a></a></span>
<span id="cb16-8"><a></a><span class="cf">for</span> FASTQ <span class="kw">in</span> fastq_files:</span>
<span id="cb16-9"><a></a>    <span class="co">#name without extensions</span></span>
<span id="cb16-10"><a></a>    FASTQ_BASENAME <span class="op">=</span> FASTQ.split(<span class="st">"."</span>)[<span class="dv">0</span>] </span>
<span id="cb16-11"><a></a>    <span class="co">#target with file-dependent name and inputs/outputs</span></span>
<span id="cb16-12"><a></a>    gwf.target( <span class="ss">f'FastQC_</span><span class="sc">{</span>FASTQ_BASENAME<span class="sc">}</span><span class="ss">'</span>, </span>
<span id="cb16-13"><a></a>           cores<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb16-14"><a></a>           memory<span class="op">=</span><span class="st">'8gb'</span>,</span>
<span id="cb16-15"><a></a>           walltime<span class="op">=</span><span class="st">'00:05:00'</span>, </span>
<span id="cb16-16"><a></a>           inputs<span class="op">=</span>[<span class="ss">f'data/</span><span class="sc">{</span>FASTQ<span class="sc">}</span><span class="ss">'</span>], </span>
<span id="cb16-17"><a></a>           outputs<span class="op">=</span>[<span class="ss">f'data/</span><span class="sc">{</span>FASTQ_BASENAME<span class="sc">}</span><span class="ss">_fastqc.html'</span>, </span>
<span id="cb16-18"><a></a>                    <span class="ss">f'data/</span><span class="sc">{</span>FASTQ_BASENAME<span class="sc">}</span><span class="ss">_fastqc.zip'</span>]) <span class="op">&lt;&lt;</span> <span class="st">""" </span></span>
<span id="cb16-19"><a></a><span class="st">    fastqc data/</span><span class="sc">{FASTQ}</span></span>
<span id="cb16-20"><a></a><span class="st">    """</span>.<span class="bu">format</span>(FASTQ<span class="op">=</span>FASTQ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="useful-gwf-checks-and-debug" class="slide level2">
<h2>Useful gwf checks and debug</h2>
<p>You can see the status with specific messages about the status of each target and what causes it.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> <span class="at">-f</span> WF02_report_parallel.py <span class="at">-v</span> debug status</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>At the end of the debug messages, you will see that one FastQC is already complete from the first example.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">⨯</span> FastQC_SRR2584866_1 shouldrun</span>
<span id="cb18-2"><a aria-hidden="true" tabindex="-1"></a><span class="ex">⨯</span> FastQC_SRR2589044_1 shouldrun</span>
<span id="cb18-3"><a aria-hidden="true" tabindex="-1"></a><span class="ex">✓</span> FastQC_SRR2584863_1 completed</span>
<span id="cb18-4"><a aria-hidden="true" tabindex="-1"></a><span class="ex">⨯</span> FastQC_SRR2584863_2 shouldrun</span>
<span id="cb18-5"><a aria-hidden="true" tabindex="-1"></a><span class="ex">⨯</span> FastQC_SRR2589044_2 shouldrun</span>
<span id="cb18-6"><a aria-hidden="true" tabindex="-1"></a><span class="ex">⨯</span> FastQC_SRR2584866_2 shouldrun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

<p>You can print explicitely some targets of your choice and their dependencies. For example all the targets related to the first element of the fastq pairs:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> <span class="at">-f</span> WF02_report_parallel.py info FastQC<span class="pp">*</span>_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>&nbsp;</p>
<p>Giving no names will print all the targets</p>
</section>
<section class="slide level2">

<p>Try to run the whole workflow and follow its status with <code>watch</code>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> <span class="at">-f</span> WF02_report_parallel.py run</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">watch</span> gwf <span class="at">-f</span> WF02_report_parallel.py status</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>&nbsp;</p>
<p>Targets will run independently and might run at the same time.</p>
</section>
<section class="slide level2">

<p>See specifically what gwf states about your targets: why a target should run, why not?</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> <span class="at">-f</span> WF02_report_parallel.py <span class="at">-v</span> debug status</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>&nbsp;</p>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Tip</strong></p>
</div>
<div class="callout-content">
<p>When developing a workflow, take your time to use <code>status</code> and <code>info</code> once you add new targets.</p>
</div>
</div>
</div>
</section></section>
<section>
<section id="multiple-target-dependencies" class="title-slide slide level1 center">
<h1>Multiple target dependencies</h1>

<img data-src="img/whole_gwf_2.png" class="r-stretch quarto-figure-center"><p class="caption">A single target (MultiQC) is dependent on the execution of multiple targets (FastQC of the data files)</p></section>
<section class="slide level2">

<div class="sourceCode" id="cb23" data-code-line-numbers="1-2|4|8-11|12-14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a></a><span class="co">#names without path and extensions</span></span>
<span id="cb23-2"><a></a>fastq_basenames <span class="op">=</span> [ FASTQ.split(<span class="st">"."</span>)[<span class="dv">0</span>] <span class="cf">for</span> FASTQ <span class="kw">in</span> fastq_files ] </span>
<span id="cb23-3"><a></a></span>
<span id="cb23-4"><a></a>gwf.target( <span class="st">'MultiQC'</span>, <span class="co">#name of the target</span></span>
<span id="cb23-5"><a></a>           cores<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb23-6"><a></a>           memory<span class="op">=</span><span class="st">'8gb'</span>,</span>
<span id="cb23-7"><a></a>           walltime<span class="op">=</span><span class="st">'00:05:00'</span>, </span>
<span id="cb23-8"><a></a>           inputs<span class="op">=</span> {<span class="st">'ZIP'</span>: [<span class="ss">f'data/</span><span class="sc">{</span>FASTQ_BASENAME<span class="sc">}</span><span class="ss">_fastqc.zip'</span> <span class="cf">for</span> FASTQ_BASENAME <span class="kw">in</span> fastq_basenames],</span>
<span id="cb23-9"><a></a>                    <span class="st">'REPORTS'</span>: [<span class="ss">f'data/</span><span class="sc">{</span>FASTQ_BASENAME<span class="sc">}</span><span class="ss">_fastqc.html'</span> <span class="cf">for</span> FASTQ_BASENAME <span class="kw">in</span> fastq_basenames] }, </span>
<span id="cb23-10"><a></a>           outputs<span class="op">=</span>[<span class="st">'results/multiqc_output/multiqc_report.html'</span>],</span>
<span id="cb23-11"><a></a>           protect<span class="op">=</span>[<span class="st">'results/multiqc_output/multiqc_report.html'</span>]) <span class="op">&lt;&lt;</span> <span class="st">""" </span></span>
<span id="cb23-12"><a></a><span class="st">    mkdir -p results/multiqc_output</span></span>
<span id="cb23-13"><a></a><span class="st">    multiqc --outdir results/multiqc_output </span><span class="ch">\</span></span>
<span id="cb23-14"><a></a><span class="st">            data/</span></span>
<span id="cb23-15"><a></a><span class="st">    """</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="protected-outputs-and-cleaning" class="slide level2">
<h2>protected outputs and cleaning</h2>
<p>The workflow parameter</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a aria-hidden="true" tabindex="-1"></a>protect<span class="op">=</span>[<span class="st">'results/multiqc_output/multiqc_report.html'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>prevents you from deleting the specified file when using <code>clean</code>. The <code>clean</code> command removes all <strong>intermediate outputs</strong> of a workflow (not essential for the result report and which <strong>can be replicated</strong> by rerunning the workflow). &nbsp;</p>
<div title="Endpoints' files are protected">
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Endpoints’ files are protected</strong></p>
</div>
<div class="callout-content">
<p>Files generated by <code>endpoints</code> (targets which are not dependencies of others, i.e.&nbsp;at the end of the workflow) do not get deleted. <code>clean --all</code> removes any file in the workflow.</p>
</div>
</div>
</div>
</div>
</section>
<section id="status-with-filters" class="slide level2">
<h2>status with filters</h2>
<p>We know all FastQC targets are completed. Run first the workflow</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> <span class="at">-f</span> WF03_multi_report.py run</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<p>&nbsp;</p>
<p>Now look only at the endpoints to avoid a long list of FastQC targets:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> <span class="at">-f</span> WF03_multi_report.py status <span class="at">--endpoints</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>gives for example</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">↻</span> MultiQC     running</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>unless it is still <code>submitted</code> or already <code>completed</code>.</p>
</div>
</section>
<section class="slide level2">

<p>Are you waiting for many endpoints? Look only for the <code>completed</code> ones with the status filter:</p>
<p>&nbsp;</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> <span class="at">-f</span> WF03_multi_report.py status <span class="at">--endpoints</span> <span class="at">-s</span> completed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>&nbsp;</p>
<p>(You can also use the status <code>running</code>, <code>shouldrun</code> or <code>failed</code>).</p>
</section></section>
<section>
<section id="exercise-1" class="title-slide slide level1 center">
<h1>Exercise 1</h1>

<img data-src="img/whole_gwf_3.png" class="r-stretch quarto-figure-center"><p class="caption">Parallel targets dependent on <code>MultiQC</code> produce trimmed <code>fastq</code> files.</p></section>
<section id="tasks-questions" class="slide level2 scrollable">
<h2>Tasks-questions</h2>
<p>Consider the workflow file <code>WF04_trimming.py</code>:</p>
<p>&nbsp;</p>
<ol type="1">
<li>apply <code>gwf status</code> to watch the <strong>endpoints of the workflow</strong></li>
<li>Which is the file dependency <strong>common to all trim targets</strong>?</li>
<li>run the workflow and…</li>
<li>…apply <code>watch gwf status</code> and follow only the <code>running</code> targets</li>
<li>Look at the <code>stderr</code> printout of one trimming target</li>
</ol>
</section>
<section id="code" class="slide level2">
<h2>Code</h2>
<div class="sourceCode" id="cb29" data-code-line-numbers="1|4|8-15|22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a></a>fastq_pairs <span class="op">=</span> np.unique([ FASTQ.split(<span class="st">'_'</span>)[<span class="dv">0</span>] <span class="cf">for</span> FASTQ <span class="kw">in</span> fastq_basenames ]) <span class="co">#names without pair number and extension</span></span>
<span id="cb29-2"><a></a></span>
<span id="cb29-3"><a></a><span class="cf">for</span> FASTQ_PAIR <span class="kw">in</span> fastq_pairs:</span>
<span id="cb29-4"><a></a>    gwf.target( <span class="ss">f"Trimmomatic_</span><span class="sc">{</span>FASTQ_PAIR<span class="sc">}</span><span class="ss">"</span>, <span class="co">#name of the target</span></span>
<span id="cb29-5"><a></a>           cores<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb29-6"><a></a>           memory<span class="op">=</span><span class="st">'8gb'</span>,</span>
<span id="cb29-7"><a></a>           walltime<span class="op">=</span><span class="st">'00:10:00'</span>, </span>
<span id="cb29-8"><a></a>           inputs<span class="op">=</span> {<span class="st">'ADAPTERS'</span>: [<span class="st">'fasta/NexteraPE-PE.fa'</span>],</span>
<span id="cb29-9"><a></a>                    <span class="st">'FASTQS'</span>: [<span class="ss">f'data/</span><span class="sc">{</span>FASTQ_PAIR<span class="sc">}</span><span class="ss">_1.fastq.gz'</span>,</span>
<span id="cb29-10"><a></a>                               <span class="ss">f'data/</span><span class="sc">{</span>FASTQ_PAIR<span class="sc">}</span><span class="ss">_2.fastq.gz'</span>],</span>
<span id="cb29-11"><a></a>                    <span class="st">'MULTIQC'</span>: [<span class="st">'results/multiqc_output/multiqc_report.html'</span>]}, </span>
<span id="cb29-12"><a></a>           outputs<span class="op">=</span>[<span class="ss">f'data_trim/</span><span class="sc">{</span>FASTQ_PAIR<span class="sc">}</span><span class="ss">_1.trim.fastq.gz'</span>,</span>
<span id="cb29-13"><a></a>                    <span class="ss">f'data_trim/</span><span class="sc">{</span>FASTQ_PAIR<span class="sc">}</span><span class="ss">_1un.trim.fastq.gz'</span>,</span>
<span id="cb29-14"><a></a>                    <span class="ss">f'data_trim/</span><span class="sc">{</span>FASTQ_PAIR<span class="sc">}</span><span class="ss">_2.trim.fastq.gz'</span>,</span>
<span id="cb29-15"><a></a>                    <span class="ss">f'data_trim/</span><span class="sc">{</span>FASTQ_PAIR<span class="sc">}</span><span class="ss">_2un.trim.fastq.gz'</span>]) <span class="op">&lt;&lt;</span> <span class="st">"""</span></span>
<span id="cb29-16"><a></a><span class="st">    mkdir -p data_trim</span></span>
<span id="cb29-17"><a></a><span class="st">    trimmomatic PE -threads 8 </span><span class="ch">\</span></span>
<span id="cb29-18"><a></a><span class="st">                data/</span><span class="sc">{FASTQ_PAIR}</span><span class="st">_1.fastq.gz data/</span><span class="sc">{FASTQ_PAIR}</span><span class="st">_2.fastq.gz </span><span class="ch">\</span></span>
<span id="cb29-19"><a></a><span class="st">                data_trim/</span><span class="sc">{FASTQ_PAIR}</span><span class="st">_1.trim.fastq.gz data_trim/</span><span class="sc">{FASTQ_PAIR}</span><span class="st">_1un.trim.fastq.gz </span><span class="ch">\</span></span>
<span id="cb29-20"><a></a><span class="st">                data_trim/</span><span class="sc">{FASTQ_PAIR}</span><span class="st">_2.trim.fastq.gz data_trim/</span><span class="sc">{FASTQ_PAIR}</span><span class="st">_2un.trim.fastq.gz </span><span class="ch">\</span></span>
<span id="cb29-21"><a></a><span class="st">                SLIDINGWINDOW:4:20 MINLEN:25 ILLUMINACLIP:</span><span class="sc">{ADAPTERFILE}</span><span class="st">:2:40:15</span></span>
<span id="cb29-22"><a></a><span class="st">    """</span>.<span class="bu">format</span>(FASTQ_PAIR<span class="op">=</span>FASTQ_PAIR, ADAPTERFILE<span class="op">=</span><span class="st">'fasta/NexteraPE-PE.fa'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="answers" class="slide level2">
<h2>Answers</h2>
<p><strong>1. apply <code>gwf status</code> to watch the endpoints of the workflow</strong></p>
<p>&nbsp;</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> <span class="at">-f</span> WF04_trimming.py status <span class="at">--endpoints</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>gives</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">⨯</span> Trimmomatic_SRR2584863 shouldrun</span>
<span id="cb31-2"><a aria-hidden="true" tabindex="-1"></a><span class="ex">⨯</span> Trimmomatic_SRR2584866 shouldrun</span>
<span id="cb31-3"><a aria-hidden="true" tabindex="-1"></a><span class="ex">⨯</span> Trimmomatic_SRR2589044 shouldrun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

<p><strong>2. Which is the file dependency common to all trim targets?</strong></p>
<p>&nbsp;</p>
<p>Each endpoint needs an adapter <code>fasta</code> file apart from the raw data files in input. You can look at the file dependencies using</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> <span class="at">-f</span> WF04_trimming.py info Trimmomatic<span class="pp">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

<p><strong>3. run the workflow</strong> <strong>4. use <code>watch gwf status</code> and follow only the <code>running</code> targets</strong></p>
<p>&nbsp;</p>
<p>After running the targets, for example with</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> <span class="at">-f</span> WF04_trimming.py run Trimmomatic<span class="pp">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>you can follow the running targets with</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">watch</span> gwf <span class="at">-f</span> WF04_trimming.py status <span class="at">-s</span> running</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If the targets are currently <code>running</code> and neither <code>shouldrun</code>, <code>completed</code> nor <code>failed</code>, you should see something like this,</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">↻</span> Trimmomatic_SRR2584863 running</span>
<span id="cb35-2"><a aria-hidden="true" tabindex="-1"></a><span class="ex">↻</span> Trimmomatic_SRR2584866 running</span>
<span id="cb35-3"><a aria-hidden="true" tabindex="-1"></a><span class="ex">↻</span> Trimmomatic_SRR2589044 running</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>after which the targets will be <code>completed</code> (and disappear from your view with the status filter).</p>
</section>
<section class="slide level2">

<p><strong>5. Look at the stderr printout of one trimming target</strong></p>
<p>&nbsp;</p>
<p>You can see the <code>stderr</code> f a trimming job, for example, by</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> <span class="at">-f</span> WF04_trimming.py logs <span class="at">-e</span> Trimmomatic_SRR2589044</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section></section>
<section>
<section id="exercise-2" class="title-slide slide level1 center">
<h1>Exercise 2</h1>

<img data-src="img/whole_gwf_4.png" class="r-stretch quarto-figure-center"><p class="caption">Parallel targets (<code>BWA</code>), each dependent on a pair of trimming targets, produce alignments of parts of the whole genome using an indexing of the reference (<code>Index reference</code>). Those alignment are then merged (<code>Merge</code>) and a depth histogram is also produced for each subgenome (<code>Histogram</code>).</p></section>
<section id="tasks-questions-1" class="slide level2 scrollable">
<h2>Tasks-questions</h2>
<p>Consider the workflow file <code>WF05_align_merge_plot.py</code>:</p>
<p>&nbsp;</p>
<ol type="1">
<li>use <code>status</code> to see which are the endpoint targets, then find their target dependencies</li>
<li>do you need to protect the final merged alignment in the target <code>BAM_merge</code>?</li>
<li>can the targets <code>BAM_merge</code> and <code>Histogram</code> run at the same time?</li>
<li>A pair of fastq files is twice as large than the other two. If instead of aligning data in parallel targets you were to <strong>align pairs one at a time in the same target</strong>, how much more time would it take? (assuming parallel targets start running at the same time)</li>
<li>Run the workflow and <code>watch</code> the <code>status</code> of the targets. You should see the running targets following the order of the dependencies. You should also find the pdf plot in the <code>results</code> folder.</li>
</ol>
</section>
<section id="code-1" class="slide level2">
<h2>Code</h2>
<div class="sourceCode" id="cb37" data-code-line-numbers="1-2|6-10|11-24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a></a><span class="cf">for</span> FASTQ_PAIR <span class="kw">in</span> fastq_pairs:</span>
<span id="cb37-2"><a></a>    gwf.target( <span class="ss">f"BWA_mem_</span><span class="sc">{</span>FASTQ_PAIR<span class="sc">}</span><span class="ss">"</span>, <span class="co">#name of the target</span></span>
<span id="cb37-3"><a></a>           cores<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb37-4"><a></a>           memory<span class="op">=</span><span class="st">'16gb'</span>,</span>
<span id="cb37-5"><a></a>           walltime<span class="op">=</span><span class="st">'00:15:00'</span>, </span>
<span id="cb37-6"><a></a>           inputs<span class="op">=</span> {<span class="st">'INDEXING'</span>: [ <span class="st">'fasta/ecoli_rel606.fasta.'</span><span class="op">+</span> extension <span class="cf">for</span> extension <span class="kw">in</span> [<span class="st">'amb'</span>,<span class="st">'ann'</span>,<span class="st">'bwt'</span>,<span class="st">'pac'</span>,<span class="st">'sa'</span>] ],</span>
<span id="cb37-7"><a></a>                    <span class="st">'FASTQS'</span>: [<span class="ss">f'data_trim/</span><span class="sc">{</span>FASTQ_PAIR<span class="sc">}</span><span class="ss">_1.trim.fastq.gz'</span>,</span>
<span id="cb37-8"><a></a>                               <span class="ss">f'data_trim/</span><span class="sc">{</span>FASTQ_PAIR<span class="sc">}</span><span class="ss">_2.trim.fastq.gz'</span>]}, </span>
<span id="cb37-9"><a></a>           outputs<span class="op">=</span>[<span class="ss">f'results/alignments/</span><span class="sc">{</span>FASTQ_PAIR<span class="sc">}</span><span class="ss">.sort.bam'</span>,</span>
<span id="cb37-10"><a></a>                    <span class="ss">f'results/depths/</span><span class="sc">{</span>FASTQ_PAIR<span class="sc">}</span><span class="ss">.depth'</span>,<span class="st">'results/depths/hellosamtools.txt'</span> ]) <span class="op">&lt;&lt;</span> <span class="st">"""</span></span>
<span id="cb37-11"><a></a><span class="st">    mkdir -p results/alignments</span></span>
<span id="cb37-12"><a></a><span class="st">    bwa mem -t 8 fasta/ecoli_rel606.fasta </span><span class="ch">\</span></span>
<span id="cb37-13"><a></a><span class="st">            data_trim/</span><span class="sc">{FASTQ_PAIR}</span><span class="st">_1.trim.fastq.gz </span><span class="ch">\</span></span>
<span id="cb37-14"><a></a><span class="st">            data_trim/</span><span class="sc">{FASTQ_PAIR}</span><span class="st">_2.trim.fastq.gz &gt; </span><span class="ch">\</span></span>
<span id="cb37-15"><a></a><span class="st">            results/alignments/</span><span class="sc">{FASTQ_PAIR}</span><span class="st">.sam</span></span>
<span id="cb37-16"><a></a><span class="st">    samtools view -S -b results/alignments/</span><span class="sc">{FASTQ_PAIR}</span><span class="st">.sam &gt; results/alignments/</span><span class="sc">{FASTQ_PAIR}</span><span class="st">.bam</span></span>
<span id="cb37-17"><a></a><span class="st">    samtools sort -o results/alignments/</span><span class="sc">{FASTQ_PAIR}</span><span class="st">.sort.bam results/alignments/</span><span class="sc">{FASTQ_PAIR}</span><span class="st">.bam</span></span>
<span id="cb37-18"><a></a><span class="st">    ### print depths in text file</span></span>
<span id="cb37-19"><a></a><span class="st">    mkdir -p results/depths</span></span>
<span id="cb37-20"><a></a><span class="st">    samtools index results/alignments/</span><span class="sc">{FASTQ_PAIR}</span><span class="st">.sort.bam</span></span>
<span id="cb37-21"><a></a><span class="st">    samtools depth results/alignments/</span><span class="sc">{FASTQ_PAIR}</span><span class="st">.sort.bam &gt; results/depths/</span><span class="sc">{FASTQ_PAIR}</span><span class="st">.depth &amp;&amp; touch hellosamtools.txt</span></span>
<span id="cb37-22"><a></a><span class="st">    """</span>.<span class="bu">format</span>(FASTQ_PAIR<span class="op">=</span>FASTQ_PAIR)</span>
<span id="cb37-23"><a></a></span>
<span id="cb37-24"><a></a>gwf.target( <span class="st">"BAM_merge"</span>, <span class="co">#name of the target</span></span>
<span id="cb37-25"><a></a>           cores<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb37-26"><a></a>           memory<span class="op">=</span><span class="st">'8gb'</span>,</span>
<span id="cb37-27"><a></a>           walltime<span class="op">=</span><span class="st">'00:10:00'</span>, </span>
<span id="cb37-28"><a></a>           inputs<span class="op">=</span> [<span class="ss">f'results/alignments/</span><span class="sc">{</span>FASTQ_PAIR<span class="sc">}</span><span class="ss">.sort.bam'</span> <span class="cf">for</span> FASTQ_PAIR <span class="kw">in</span> fastq_pairs], </span>
<span id="cb37-29"><a></a>           outputs<span class="op">=</span>[<span class="st">'results/alignments/merged.bam'</span>]) <span class="op">&lt;&lt;</span> <span class="st">"""</span></span>
<span id="cb37-30"><a></a><span class="st">    samtools merge -f results/alignments/merged.bam results/alignments/*.sort.bam</span></span>
<span id="cb37-31"><a></a><span class="st">    samtools sort results/alignments/merged.bam -o results/alignments/merged.final.bam</span></span>
<span id="cb37-32"><a></a><span class="st">    """</span></span>
<span id="cb37-33"><a></a></span>
<span id="cb37-34"><a></a>gwf.target( <span class="st">"Histogram"</span>, <span class="co">#name of the target</span></span>
<span id="cb37-35"><a></a>           cores<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb37-36"><a></a>           memory<span class="op">=</span><span class="st">'8gb'</span>,</span>
<span id="cb37-37"><a></a>           walltime<span class="op">=</span><span class="st">'00:10:00'</span>, </span>
<span id="cb37-38"><a></a>           inputs<span class="op">=</span> [<span class="ss">f'results/depths/</span><span class="sc">{</span>FASTQ_PAIR<span class="sc">}</span><span class="ss">.depth'</span> <span class="cf">for</span> FASTQ_PAIR <span class="kw">in</span> fastq_pairs], </span>
<span id="cb37-39"><a></a>           outputs<span class="op">=</span>[ <span class="st">'results/depths/histogram.pdf'</span> ]) <span class="op">&lt;&lt;</span> <span class="st">"""</span></span>
<span id="cb37-40"><a></a><span class="st">    Rscript plotscript.R</span></span>
<span id="cb37-41"><a></a><span class="st">    """</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="answers-1" class="slide level2">
<h2>Answers</h2>
<p><strong>1. use <code>status</code> to see which are the endpoint targets, then find their target dependencies</strong></p>
<p>&nbsp;</p>
<p>There are two endpoints: one for merging aligned files and one for plotting a histogram. Use</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb38-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> <span class="at">-f</span> WF05_align_merge_plot.py status <span class="at">--endpoints</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>to obtain</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb39-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">⨯</span> BAM_merge     shouldrun</span>
<span id="cb39-2"><a aria-hidden="true" tabindex="-1"></a><span class="ex">⨯</span> Histogram     shouldrun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<p>Use the <code>info</code> command to see their file dependencies:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb40-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> <span class="at">-f</span> WF05_align_merge_plot.py info Histogram BAM_merge</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Look at the output to find out that <code>Histogram</code> and <code>BAM_merge</code> depend both on the following targets</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb41-1"><a aria-hidden="true" tabindex="-1"></a><span class="st">"BWA_mem_SRR2589044"</span><span class="ex">,</span></span>
<span id="cb41-2"><a aria-hidden="true" tabindex="-1"></a><span class="st">"BWA_mem_SRR2584866"</span><span class="ex">,</span></span>
<span id="cb41-3"><a aria-hidden="true" tabindex="-1"></a><span class="st">"BWA_mem_SRR2584863"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>Note though that they depend on different files from those targets!</p>
</div>
</section>
<section class="slide level2">

<p><strong>2. do you need to protect the final merged alignment in the target <code>BAM_merge</code>?</strong></p>
<p>&nbsp;</p>
<p><code>BAM_merge</code> is an endpoint target, so its files do not need to be protected in case you want to do a cleanup with <code>gwf clean</code>. You can clean all files anyway with <code>gwf clean --all</code>.</p>
</section>
<section class="slide level2">

<p><strong>3. can the targets <code>BAM_merge</code> and <code>Histogram</code> run at the same time?</strong></p>
<p>&nbsp;</p>
<p>Yes, as soon as the raw data files have been aligned separately.</p>
</section>
<section class="slide level2">

<p><strong>4. A pair of fastq files is twice as large than the other two. If instead of aligning data in parallel targets you were to </strong>align pairs one at a time in the same target<strong>, how much more time would it take? (assuming parallel targets start running at the same time)</strong></p>
<p>&nbsp;</p>
<p>If you run a single target with the alignment of all pairs, it will take twice the time compared to running parallel targets.</p>
<p>When you run <strong>parallel targets</strong>, the time needed to finish the alignments is the <strong>time needed for the largest pair</strong> (which is twice the size of the others).</p>
<p>&nbsp;</p>
<div class="fragment">
<p>When you run <strong>sequentially</strong> the alignments, it takes the <strong>sum of all alignment times</strong> to get done.</p>
<p><img data-src="img/seq_or_par.png"></p>
</div>
</section></section>
<section>
<section id="clean-up-after-yourself" class="title-slide slide level1 center">
<h1>Clean up after yourself</h1>
<p>Use the <code>tree</code> command to look at how many files you created!</p>
<div class="fragment">
<p>&nbsp;</p>
<p>What is the size of each folder and their total size?</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb42-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">du</span> <span class="at">-h</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We have 8.3GB of data</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb43-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">17K</span>     ./__pycache__</span>
<span id="cb43-2"><a aria-hidden="true" tabindex="-1"></a><span class="ex">961M</span>    ./data_trim</span>
<span id="cb43-3"><a aria-hidden="true" tabindex="-1"></a><span class="ex">5.8G</span>    ./results/alignments</span>
<span id="cb43-4"><a aria-hidden="true" tabindex="-1"></a><span class="ex">13K</span>     ./results/multiqc_output/multiqc_data</span>
<span id="cb43-5"><a aria-hidden="true" tabindex="-1"></a><span class="ex">17K</span>     ./results/multiqc_output</span>
<span id="cb43-6"><a aria-hidden="true" tabindex="-1"></a><span class="ex">286M</span>    ./results/depths</span>
<span id="cb43-7"><a aria-hidden="true" tabindex="-1"></a><span class="ex">6.1G</span>    ./results</span>
<span id="cb43-8"><a aria-hidden="true" tabindex="-1"></a><span class="ex">1.0K</span>    ./Environments</span>
<span id="cb43-9"><a aria-hidden="true" tabindex="-1"></a><span class="ex">39K</span>     ./.gwf/logs</span>
<span id="cb43-10"><a aria-hidden="true" tabindex="-1"></a><span class="ex">40K</span>     ./.gwf</span>
<span id="cb43-11"><a aria-hidden="true" tabindex="-1"></a><span class="ex">1.2G</span>    ./data</span>
<span id="cb43-12"><a aria-hidden="true" tabindex="-1"></a><span class="ex">13M</span>     ./fasta</span>
<span id="cb43-13"><a aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>       ./.empty</span>
<span id="cb43-14"><a aria-hidden="true" tabindex="-1"></a><span class="ex">8.3G</span>    .</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>Try to use</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb44-1"><a aria-hidden="true" tabindex="-1"></a><span class="ex">gwf</span> <span class="at">-f</span> WF05_align_merge_plot.py clean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>accept the warning message and note how, already for a small exercise, you are going to cleanup a lot.</p>
</section>
<section class="slide level2">

<p>Now you have a more slim folder, which contains workflows, raw data, a merged quality report, aligned data and depth histogram in <code>.pdf</code>.</p>
<p>&nbsp;</p>
<p>All the other files can be recreated at any moment if necessary.</p>
<p>&nbsp;</p>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Tip</strong></p>
</div>
<div class="callout-content">
<p>Remember: <strong>Computation cost &lt;&lt; Storage cost</strong></p>
</div>
</div>
</div>
</section></section>
<section>
<section id="last-tips" class="title-slide slide level1 center">
<h1>Last tips</h1>

</section>
<section id="using-a-separate-conda-environment-in-a-target" class="slide level2">
<h2>Using a separate conda environment in a target</h2>
<p>You might have a conda environment with a specific version of the package <code>gwf</code>, and then another environment with relevant packages, called for example <code>tools_environment</code>.</p>
<div class="fragment">
<p>To activate that environment, add two lines into your <code>bash</code> code executed by the target:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb45-1"><a aria-hidden="true" tabindex="-1"></a>    <span class="bu">eval</span> <span class="st">"</span><span class="va">$(</span><span class="ex">conda</span> shell.bash hook<span class="va">)</span><span class="st">"</span> </span>
<span id="cb45-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="ex">conda</span> activate tools_environment</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>For example:</p>
<div class="sourceCode" id="cb46" data-code-line-numbers="1-3|6|7-9|10-12|13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a></a><span class="im">from</span> gwf <span class="im">import</span> Workflow</span>
<span id="cb46-2"><a></a></span>
<span id="cb46-3"><a></a>gwf <span class="op">=</span> Workflow(defaults<span class="op">=</span>{<span class="st">'account'</span>: <span class="st">'your_project'</span>})</span>
<span id="cb46-4"><a></a></span>
<span id="cb46-5"><a></a><span class="co">## A target doing FastQC on a file</span></span>
<span id="cb46-6"><a></a>gwf.target(<span class="st">'FastQC'</span>, </span>
<span id="cb46-7"><a></a>           cores<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb46-8"><a></a>           memory<span class="op">=</span><span class="st">'8gb'</span>,</span>
<span id="cb46-9"><a></a>           walltime<span class="op">=</span><span class="st">'00:05:00'</span>, </span>
<span id="cb46-10"><a></a>           inputs<span class="op">=</span>[<span class="st">'data/SRR2584863_1.fastq.gz'</span>], </span>
<span id="cb46-11"><a></a>           outputs<span class="op">=</span>[<span class="st">'data/SRR2584863_1_fastqc.html'</span>, </span>
<span id="cb46-12"><a></a>                    <span class="st">'data/SRR2584863_1_fastqc.zip'</span>]) <span class="op">&lt;&lt;</span> <span class="st">""" </span></span>
<span id="cb46-13"><a></a><span class="st">eval "$(conda shell.bash hook)" </span></span>
<span id="cb46-14"><a></a><span class="st">conda activate tools_environment</span></span>
<span id="cb46-15"><a></a><span class="st">fastqc data/SRR2584863_1.fastq.gz</span></span>
<span id="cb46-16"><a></a><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="use-templates" class="slide level2">
<h2>Use templates</h2>
<p>You can define templates in your workflow, or in a separate file called for example <code>templates.py</code>. A template for the <code>FastQC</code> target could be</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fastqc(<span class="bu">input</span><span class="op">=</span><span class="st">""</span>, cores<span class="op">=</span><span class="dv">1</span>, memory<span class="op">=</span><span class="st">'8gb'</span>, walltime<span class="op">=</span><span class="st">'00:05:00'</span>):</span>
<span id="cb47-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A template for fastqc"""</span></span>
<span id="cb47-3"><a aria-hidden="true" tabindex="-1"></a>    inputs <span class="op">=</span> [<span class="ss">f'</span><span class="sc">{</span><span class="bu">input</span><span class="sc">}</span><span class="ss">.fastq.gz'</span>]</span>
<span id="cb47-4"><a aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> [<span class="ss">f'</span><span class="sc">{</span><span class="bu">input</span><span class="sc">}</span><span class="ss">_fastqc.zip'</span>,<span class="ss">f'</span><span class="sc">{</span><span class="bu">input</span><span class="sc">}</span><span class="ss">_fastqc.html'</span>]</span>
<span id="cb47-5"><a aria-hidden="true" tabindex="-1"></a>    options <span class="op">=</span> {</span>
<span id="cb47-6"><a aria-hidden="true" tabindex="-1"></a>        <span class="st">'cores'</span>: cores,</span>
<span id="cb47-7"><a aria-hidden="true" tabindex="-1"></a>        <span class="st">'memory'</span>: memory,</span>
<span id="cb47-8"><a aria-hidden="true" tabindex="-1"></a>        <span class="st">'walltime'</span>: walltime</span>
<span id="cb47-9"><a aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb47-10"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a aria-hidden="true" tabindex="-1"></a>    spec <span class="op">=</span> <span class="st">'''</span></span>
<span id="cb47-12"><a aria-hidden="true" tabindex="-1"></a><span class="st">    fastqc </span><span class="sc">{input}</span></span>
<span id="cb47-13"><a aria-hidden="true" tabindex="-1"></a><span class="st">    '''</span>.<span class="bu">format</span>(<span class="bu">input</span><span class="op">=</span>inputs[<span class="dv">0</span>])</span>
<span id="cb47-14"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-15"><a aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> AnonymousTarget(inputs<span class="op">=</span>inputs, outputs<span class="op">=</span>outputs, options<span class="op">=</span>options, spec<span class="op">=</span>spec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

<p>the workflow file contains now <code>import</code> to import the template, and uses it afterwards to define a target:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gwf <span class="im">import</span> Workflow</span>
<span id="cb48-2"><a aria-hidden="true" tabindex="-1"></a><span class="im">import</span> template</span>
<span id="cb48-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a aria-hidden="true" tabindex="-1"></a>gwf <span class="op">=</span> Workflow(defaults<span class="op">=</span>{<span class="st">'account'</span>: <span class="st">'your_project'</span>})</span>
<span id="cb48-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a aria-hidden="true" tabindex="-1"></a><span class="co">## A target doing FastQC on a file</span></span>
<span id="cb48-7"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a aria-hidden="true" tabindex="-1"></a>gwf.target_from_template(</span>
<span id="cb48-9"><a aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">'fastqc_from_template'</span>,</span>
<span id="cb48-10"><a aria-hidden="true" tabindex="-1"></a>    template<span class="op">=</span>fastqc(<span class="bu">input</span><span class="op">=</span><span class="st">'data/SRR2584863_1'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="add-new-files-after-running-a-workflow" class="slide level2">
<h2>Add new files after running a workflow</h2>
<p>If you add new data files and your workflow reads which files there are automatically, creating corresponding targets, then adding new files will update your workflow with new targets to be executed.</p>
<div class="fragment">
<p>&nbsp;</p>
<p><strong>Example:</strong> adding new <code>fastq.gz</code> files in the <code>data</code> folder of this workshop will update the workflow adding new steps and rendering others from <code>completed</code> to <code>shouldrun</code>.</p>


</div>
</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="img/logos.png" class="slide-logo"></p>
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'h.v',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/hds-sandbox\.github\.io\/GDKworkshops\/");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>